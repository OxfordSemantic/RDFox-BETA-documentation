<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>16. APIs &mdash; RDFox  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/ost_theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/dev-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.46.2/dist/instantsearch.production.min.js"></script>
        <script defer="defer" src="_static/algolia.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="17. Javadoc" href="javadoc.html" />
    <link rel="prev" title="15. RDFox Shell" href="rdfox-shell.html" />
    <!-- Start of HubSpot Cookie Blocking Code -->
    <script type="application/javascript" id="hs-cookie-banner-scan" data-hs-allowed="true" src="https://js.hs-banner.com/cookie-scanning/6485449/4b9c57c39524d7b4a85dd163da87b1d54dc9b0e11f55359272e78d1092aa8d77.js"></script>
    <!-- End of HubSpot Cookie Blocking Code -->

     

    <!-- Set up consent mode for Google Analytics -->
    <!-- Retrieve previous consent settings if present, otherwise deny everything -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}

        if(localStorage.getItem('consentMode') === null) {
            gtag('consent', 'default', {
                'ad_storage': 'denied',
                'analytics_storage': 'denied',
                'personalization_storage': 'denied',
                'functionality_storage': 'denied',
                'security_storage': 'denied',
                'ads_data_redaction': true,
            });
        } else {
            gtag('consent', 'default', JSON.parse(localStorage.getItem('consentMode')));
        }
    </script>
    <!-- End of consent mode setup for Google Analytics -->

    <!-- Listen for consent changes from HubSpot consent banner -->
    <script>
        var _hsp = window._hsp = window._hsp || [];
        _hsp.push(['addPrivacyConsentListener', function(consent) {
            const consentMode = {
                'ad_storage': consent.categories.advertisement ? 'granted' : 'denied',
                'analytics_storage': consent.categories.analytics ? 'granted' : 'denied',
                'personalization_storage': consent.categories.advertisement ? 'granted' : 'denied',
                'functionality_storage': consent.categories.functionality ? 'granted' : 'denied',
                'security_storage': consent.categories.functionality ? 'granted' : 'denied',
                'ads_data_redaction': consent.categories.advertisement ? false : true,
            };
            gtag('consent', 'update', consentMode);
            localStorage.setItem('consentMode', JSON.stringify(consentMode))

            // Google Tag Manager
            function addGtm(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
                var f=d.getElementsByTagName(s)[0];
                var j=d.createElement(s);
                var dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            }
            if(
                consent.categories.analytics
                || consent.categories.functionality
                || consent.categories.advertisement
            ) {
                addGtm(window,document,'script','dataLayer','GTM-WFM2Q9D');
            }
            // End of Google Tag Manager code
        }]);
    </script>
    <!-- End of consent listener -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="welcome-to-rdfox.html">1. Welcome to RDFox</a></li>
<li class="toctree-l1"><a class="reference internal" href="features-and-requirements.html">2. RDFox Features and Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">3. Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Organization of Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="servers.html">4. Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-stores.html">5. Data Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuple-tables.html">6. Tuple Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-sources.html">7. Data Sources</a></li>
</ul>
<p class="caption"><span class="caption-text">Functionality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="import-and-export.html">8. Import and Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html">9. Querying</a></li>
<li class="toctree-l1"><a class="reference internal" href="reasoning.html">10. Reasoning</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">11. Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="access-control.html">12. Access Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistence.html">13. Persistence</a></li>
</ul>
<p class="caption"><span class="caption-text">Interfaces</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="connections.html">14. Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="rdfox-shell.html">15. RDFox Shell</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">16. APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics-of-the-java-api">16.1. Basics of the Java API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-and-stopping-the-server">16.1.1. Starting and Stopping the Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connections">16.1.2. Connections</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basics-of-the-restful-api">16.2. Basics of the RESTful API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentication">16.2.1. Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication-mechanisms">16.2.1.1. Authentication Mechanisms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-the-current-authentication-status">16.2.1.2. Retrieving the Current Authentication Status</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#suppressing-the-www-authenticate-response-header">16.2.2. Suppressing the WWW-Authenticate response header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#treating-get-results-as-answers-to-sparql-queries">16.2.3. Treating <code class="docutils literal notranslate"><span class="pre">GET</span></code> Results as Answers to SPARQL Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restful-connections-and-transactions">16.2.4. RESTful Connections and Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explicit-connection-management">16.2.5. Explicit Connection Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connections-and-concurrency">16.2.5.1. Connections and Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connection-expiry">16.2.5.2. Connection Expiry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#management-of-restful-requests">16.2.6. Management of RESTful Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-servers">16.3. Managing Servers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-server-properties">16.3.1. Retrieving Server Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-server-properties">16.3.2. Setting Server Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-server-integrity">16.3.3. Checking Server Integrity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-stores">16.4. Managing Data Stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-available-data-stores">16.4.1. Listing Available Data Stores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-data-store-parameters">16.4.2. Listing Data Store Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-data-store">16.4.3. Creating a Data Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-a-data-store">16.4.4. Deleting a Data Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bringing-a-data-store-offline-online">16.4.5. Bringing a Data Store Offline/Online</a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-data-store-state">16.4.6. Querying Data Store State</a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-diagnostic-information">16.4.7. Querying Diagnostic Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invoking-data-store-operations">16.4.8. Invoking Data Store Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-store-properties">16.5. Managing Data Store Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-data-store-properties">16.5.1. Retrieving Data Store Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-data-store-properties">16.5.2. Changing Data Store Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-store-prefixes">16.6. Managing Data Store Prefixes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-prefixes">16.6.1. Retrieving Prefixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-prefixes-in-bulk">16.6.2. Setting Prefixes in Bulk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-one-prefix">16.6.3. Setting One Prefix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unsetting-one-prefix">16.6.4. Unsetting One Prefix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-delta-queries">16.7. Managing Delta Queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-delta-queries">16.7.1. Listing Delta Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-delta-query-properties">16.7.2. Listing Delta Query Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-a-delta-query">16.7.3. Registering a Delta Query</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deregistering-a-delta-query">16.7.4. Deregistering a Delta Query</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-the-delta-query-evaluation-mode">16.7.5. Setting the Delta Query Evaluation Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-delta-query-answers">16.7.6. Listing Delta Query Answers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-a-delta-query-answer">16.7.7. Retrieving a Delta Query Answer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-delta-query-answers">16.7.8. Deleting Delta Query Answers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-the-commit-procedure">16.8. Managing the Commit Procedure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-the-commit-procedure">16.8.1. Retrieving the Commit Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-a-commit-procedure">16.8.2. Setting a Commit Procedure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-store-content">16.9. Managing Data Store Content</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-the-sparql-1-1-graph-store-http-protocol">16.9.1. Using the SPARQL 1.1 Graph Store HTTP Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-a-graph">16.9.1.1. Retrieving a Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-triples-to-a-graph">16.9.1.2. Adding Triples to a Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replacing-a-graph">16.9.1.3. Replacing a Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deleting-a-graph">16.9.1.4. Deleting a Graph</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rdfox-update-protocol">16.9.2. RDFox Update Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-data-store-content">16.9.2.1. Retrieving Data Store Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#incrementally-adding-data-store-content">16.9.2.2. Incrementally Adding Data Store Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-content-and-updating-prefixes">16.9.2.3. Adding Content and Updating Prefixes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#incrementally-deleting-data-store-content">16.9.2.4. Incrementally Deleting Data Store Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deleting-all-data-store-content">16.9.2.5. Deleting All Data Store Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replacing-all-data-store-content">16.9.2.6. Replacing All Data Store Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-deleting-owl-axioms-from-triples">16.9.2.7. Adding/Deleting OWL Axioms From Triples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-data-sources">16.10. Managing Data Sources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-the-registered-data-sources">16.10.1. Listing the Registered Data Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-information-about-a-data-source">16.10.2. Retrieving Information About a Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-a-data-source">16.10.3. Registering a Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deregistering-a-data-source">16.10.4. Deregistering a Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-the-data-source-tables-of-a-data-source">16.10.5. Listing the Data Source Tables of a Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-information-about-a-data-source-table">16.10.6. Retrieving Information About a Data Source Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sampling-a-data-source-table">16.10.7. Sampling a Data Source Table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-tuple-tables">16.11. Managing Tuple Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-the-available-tuple-tables">16.11.1. Listing the Available Tuple Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-information-about-a-tuple-table">16.11.2. Retrieving Information About a Tuple Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-tuple-table">16.11.3. Creating a Tuple Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-a-tuple-table">16.11.4. Deleting a Tuple Table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-statistics">16.12. Managing Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-the-available-statistics">16.12.1. Listing the Available Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-information-about-statistics">16.12.2. Retrieving Information About Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-statistics">16.12.3. Creating Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-statistics">16.12.4. Deleting Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-statistics">16.12.5. Updating Statistics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluating-queries">16.13. Evaluating Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-transactions">16.14. Working with Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transactions-in-the-java-api">16.14.1. Transactions in the Java API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transactions-in-the-restful-api">16.14.2. Transactions in the RESTful API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cursors">16.15. Cursors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cursors-in-the-java-api">16.15.1. Cursors in the Java API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cursors-in-the-restful-api">16.15.2. Cursors in the RESTful API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#listing-available-cursors">16.15.2.1. Listing Available Cursors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-cursor">16.15.2.2. Creating a Cursor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opening-and-advancing-a-cursor">16.15.2.3. Opening and Advancing a Cursor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-cursor-information">16.15.2.4. Retrieving Cursor Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deleting-a-cursor">16.15.2.5. Deleting a Cursor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#explaining-fact-derivation">16.16. Explaining Fact Derivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-concurrent-updates">16.17. Handling Concurrent Updates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#detecting-updates">16.17.1. Detecting Updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#java-api">16.17.1.1. Java API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restful-api">16.17.1.2. RESTful API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#conditional-requests">16.17.2. Conditional Requests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">16.17.2.1. Java API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">16.17.2.2. RESTful API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-roles">16.18. Managing Roles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-roles">16.18.1. Listing Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-role">16.18.2. Creating a Role</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-a-role">16.18.3. Deleting a Role</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-role-information">16.18.4. Listing Role Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-privileges">16.18.5. Listing Privileges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#granting-privileges-to-a-role">16.18.6. Granting Privileges to a Role</a></li>
<li class="toctree-l3"><a class="reference internal" href="#revoking-privileges-from-a-role">16.18.7. Revoking Privileges from a Role</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-memberships">16.18.8. Listing Memberships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#granting-memberships">16.18.9. Granting Memberships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#revoking-memberships">16.18.10. Revoking Memberships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listing-members">16.18.11. Listing Members</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-passwords">16.18.12. Changing Passwords</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#checking-endpoint-health">16.19. Checking Endpoint Health</a></li>
<li class="toctree-l2"><a class="reference internal" href="#remote-shell-execution">16.20. Remote Shell Execution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-remote-command-execution">16.20.1. Basic Remote Command Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#limitations">16.20.1.1. Limitations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#explicit-shell-management">16.20.2. Explicit Shell Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interrupting-remote-shell-execution">16.20.3. Interrupting Remote Shell Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inspecting-the-status-of-the-remote-shell-instance">16.20.4. Inspecting the Status of the Remote Shell Instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deletion-of-remote-shell-instances">16.20.5. Deletion of Remote Shell Instances</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="javadoc.html">17. Javadoc</a></li>
</ul>
<p class="caption"><span class="caption-text">Operations Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rdfox-executable.html">18. RDFox Executable</a></li>
<li class="toctree-l1"><a class="reference internal" href="rdfox-endpoint.html">19. RDFox Endpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">20. Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="high-availability.html">21. High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">22. RDFox Docker Images</a></li>
</ul>
<p class="caption"><span class="caption-text">Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">23. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">24. Acknowledgments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RDFox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">16. </span>APIs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="apis">
<span id="id1"></span><h1><span class="section-number">16. </span>APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h1>
<p>Programmatic control of RDFox® can be gained remotely via a RESTful API exposed
through an HTTP endpoint or in-memory via Java.</p>
<p>This section describes the functionality provided in both APIs for managing the
different information elements of the system. This section should be understood
as a reference for the JAVA and REST APIs in RDFox, and it requires
understanding of the structure of RDFox as described in <a class="reference internal" href="servers.html#servers"><span class="std std-numref">Section 4</span></a>.</p>
<div class="section" id="basics-of-the-java-api">
<span id="apis-java-basics"></span><h2><span class="section-number">16.1. </span>Basics of the Java API<a class="headerlink" href="#basics-of-the-java-api" title="Permalink to this headline">¶</a></h2>
<p>The Java API is available within Java processes that have JRDFox.jar loaded
(see <a class="reference internal" href="features-and-requirements.html#software-archive"><span class="std std-numref">Section 2.2</span></a>).</p>
<div class="section" id="starting-and-stopping-the-server">
<h3><span class="section-number">16.1.1. </span>Starting and Stopping the Server<a class="headerlink" href="#starting-and-stopping-the-server" title="Permalink to this headline">¶</a></h3>
<p>Java applications must start the RDFox server before they can connect to it.
Only one server can be started per process. The Java API exports the
<a class="reference external" href="./_javadoc/tech/oxfordsemantic/jrdfox/client/RDFoxServer.html">RDFoxServer</a>
class which has several methods for managing the server’s lifecycle. The
following examples show how to use this class to start a server so that it is
ready to create connections, and to shut it down once finished with.</p>
<p>When a server should be persistent, its server directory must be initialized
for the desired <a class="reference internal" href="persistence.html#persistence-options"><span class="std std-ref">persistence option</span></a> before the
server can be started. This is shown below. For in-memory servers, this step
should be skipped.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="n">serverDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">String</span><span class="w"> </span><span class="n">persistenceEncryptionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;persistence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;file&quot;</span><span class="p">);</span>
<span class="n">RDFoxServer</span><span class="p">.</span><span class="na">initialize</span><span class="p">(</span><span class="n">serverDirectory</span><span class="p">,</span><span class="w"> </span><span class="n">persistenceEncryptionKey</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
<p>The parameters passed to the <code class="docutils literal notranslate"><span class="pre">initialize(...)</span></code> method will be written to the
<a class="reference internal" href="servers.html#server-parameters-file"><span class="std std-ref">server parameters file</span></a> within the server
directory and will therefore apply to every subsequent server session that uses
the directory, unless the file is edited or the parameters in the file
overridden by the arguments passed to <code class="docutils literal notranslate"><span class="pre">start(...)</span></code>.</p>
<p>The server can now be started, as shown in the code below. For in-memory
servers (with no persistence), the <code class="docutils literal notranslate"><span class="pre">server-directory</span></code> parameter may be
omitted.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;server-directory&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">serverDirectory</span><span class="p">);</span>
<span class="n">RDFoxServer</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
<p>Newly created servers do not contain any roles so, before any connection can be
made, the server’s first role must be created using the <code class="docutils literal notranslate"><span class="pre">RDFoxServer</span></code>’s
<code class="docutils literal notranslate"><span class="pre">createFirstRole(...)</span></code> API. The first role automatically receives privileges
to perform any operation on the server, including the creation of additional
roles and modification of their privileges. The following code demonstrates how
to create the first role.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RDFoxServer</span><span class="p">.</span><span class="na">getNumberOfRoles</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">roleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="w">    </span><span class="n">RDFoxServer</span><span class="p">.</span><span class="na">createFirstRole</span><span class="p">(</span><span class="n">roleName</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The server is now ready to accept connections.</p>
<p>When RDFox is no longer needed by the application, the server can be stopped
which will remove all data stores from memory. Stopping the server will fail
while any connections to it or one of its data stores remain open.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">RDFoxServer</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="connections">
<h3><span class="section-number">16.1.2. </span>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h3>
<p>Once the RDFox server is started (see the previous section), Java client code
must obtain a <a class="reference internal" href="connections.html#connections"><span class="std std-ref">connection</span></a> to the server or one of its data
stores in order call the APIs described in this chapter. A connection
encapsulates the identity of the object being connected to, as well as the
credentials of the user making the connection. The following example
demonstrates a typical life cycle of a connection.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="n">roleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">ServerConnection</span><span class="w"> </span><span class="n">sConn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RDFoxServer</span><span class="p">.</span><span class="na">newServerConnection</span><span class="p">(</span><span class="n">roleName</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
<span class="c1">// Use the server connection...</span>
<span class="n">String</span><span class="w"> </span><span class="n">dataStoreName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">DataStoreConnection</span><span class="w"> </span><span class="n">dsConn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">newDataStoreConnection</span><span class="p">(</span><span class="n">dataStoreName</span><span class="p">);</span>
<span class="c1">// Use the data store connection...</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="n">sConn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</pre></div>
</div>
<p>Both server and data store connections must be closed after use in order to
release system resources. There are no requirements that a server connection
must be closed after a data store connection — that is, both connections are
independent.</p>
<p>For convenience, one can connect to a data store directly.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="n">serverURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">String</span><span class="w"> </span><span class="n">dataStoreName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">String</span><span class="w"> </span><span class="n">roleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">DataStoreConnection</span><span class="w"> </span><span class="n">dsConn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RDFoxServer</span><span class="p">.</span><span class="na">newDataStoreConnection</span><span class="p">(</span><span class="n">dataStoreName</span><span class="p">,</span><span class="w"> </span><span class="n">roleName</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
<span class="c1">// Use the data store connection...</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</pre></div>
</div>
<p>All connections are single-threaded — that is, they can safely be used only
from one thread at a time. Using the same connection from multiple threads
results in undefined behavior and can lead to a system crash (although the
server itself will not be corrupted provided that the containing process
survives the crash). To use RDFox concurrently, one should use a distinct
connection per execution thread.</p>
<p>RDFox provides various APIs for adding and deleting facts and rules. All
updates are performed within the context of a transaction, which ensures that
either all changes are performed as a unit, or no changes are performed at all.
The transaction API is described in more detail in
<a class="reference internal" href="#apis-working-with-transactions"><span class="std std-numref">Section 16.14</span></a>.</p>
<p>Adding or deleting facts or rules might require adjusting the inferred facts.
In most cases, RDFox achieves this by using highly optimized <em>incremental
reasoning</em> algorithms, whose aim is to update the derived facts while
minimizing the amount of work. This process is automatically initiated before a
query is evaluated in a transaction; thus, each query evaluated in a
transaction always sees the results of prior updates made on the transaction.
To promote performance, incremental reasoning is initiated only when a query is
issued or a transaction is committed; thus, if several updates are issued
before a transaction is committed, incremental reasoning is run only once.</p>
<p>It is generally good practice to add all rules before the facts, or to add
rules and facts in an arbitrary order but grouped in a single transaction. This
will usually increase the performance of the first reasoning operation.</p>
</div>
</div>
<div class="section" id="basics-of-the-restful-api">
<h2><span class="section-number">16.2. </span>Basics of the RESTful API<a class="headerlink" href="#basics-of-the-restful-api" title="Permalink to this headline">¶</a></h2>
<p>The RESTful API is available whenever the RDFox Endpoint is listening. Please
refer to <a class="reference internal" href="rdfox-endpoint.html#rdfox-endpoint"><span class="std std-numref">Section 19</span></a> for details of how to configure, start and
stop the endpoint.</p>
<p>The endpoint provides access to one RDFox server via the following API keys.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/                                   : management of the server (GET/PATCH)
    /authentication                 : discover configured authentication schemes (GET)
        /login                      :
            /cancel                 : cancel a login attempt (POST)
            /complete               : complete a login attempt (POST)
            /initiate               : initiate a login attempt (GET/POST)
        /logout                     : log out of a session (POST)
        /self                       : determine authentication status (GET)
    /commands                       : remote submission of shell commands (POST)
    /connections                    : management of server connections (GET/POST)
        /&lt;SRVCONN&gt;                  : management of a server connection (GET/PATCH/DELETE)
    /datastores                     : listing available data stores (GET)
        /&lt;DSTRNAME&gt;                 : management of a data store (GET/PATCH/POST/DELETE)
            /commitprocedure        : (EXPERIMENTAL) management of a data store&#39;s commit procedure (GET/PUT)
            /connections            : management of data store connections (GET/POST)
                /&lt;DSCONN&gt;           : management of a data store connection (GET/PATCH/DELETE)
                    /cursors        : management of transaction cursors (GET/POST)
                        /&lt;CURSID&gt;   : management of a cursor (GET/PATCH/DELETE)
                    /transaction    : management of the connection transaction (GET/PATCH)
            /content                : data store content (GET/PATCH/PUT/POST/DELETE)
            /datasources            : listing available data sources (GET)
                /&lt;DSRCNAME&gt;         : management of a data source (GET/POST/DELETE)
                    /tables         : listing available data source tables (GET)
                        /&lt;DTNAME&gt;   : information about a data source table (GET)
                            /data   : sampling facts of a data source table (GET)
            /deltaqueries           : management of delta queries (GET)
                /&lt;DQNAME&gt;           : management of a delta query (GET/POST/DELETE/PATCH)
            /deltaqueryanswers      : management of delta query answers (GET/DELETE)
                /content            : retrieves the content of a delta query answer (GET)
            /explanation            : explanation of the reasoning process (GET)
            /info                   : retrieving information about a data store (GET)
            /operations             : invocation of data store operations (POST)
            /prefixes               : prefixes of the data store (GET/PUT/PATCH)
            /properties             : management of the data store properties (GET/PATCH)
            /sparql                 : data store SPARQL endpoint (GET/POST)
            /stats                  : listing the available statistics (GET/PUT)
                /&lt;STNAME&gt;           : management of the statistics (GET/PUT/POST/DELETE)
            /tupletables            : listing available tuple tables (GET)
                /&lt;TTNAME&gt;           : management of a tuple table (GET/POST/DELETE)
    /health                         : checking that the endpoint is healthy (GET)
    /password                       : changing the password of the authenticated role (PUT)
    /requests                       : listing running requests (GET)
        /&lt;REQID&gt;                    : management of a particular request (GET/DELETE)
    /roles                          : listing roles (GET)
        /&lt;ROLENAME&gt;                 : management of a role (POST/DELETE)
            /privileges             : management of a role&#39;s privileges (GET/PATCH)
            /memberships            : management of a role&#39;s memberships (GET/PATCH)
            /members                : listing a role&#39;s members (GET)
   /shells                          : management of shells (GET/POST)
        /&lt;SHELL&gt;                    : management of a shell (GET/PATCH/DELETE)
</pre></div>
</div>
<div class="section" id="authentication">
<span id="rest-authentication"></span><h3><span class="section-number">16.2.1. </span>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h3>
<p>The following sections describe the authentication mechanisms and related APIs
supported by the RDFox endpoint.</p>
<div class="section" id="authentication-mechanisms">
<h4><span class="section-number">16.2.1.1. </span>Authentication Mechanisms<a class="headerlink" href="#authentication-mechanisms" title="Permalink to this headline">¶</a></h4>
<p>The following sections describe various mechanisms supported by the RDFox
endpoint for authenticating REST requests.</p>
<p>In most cases, requests that attempt to use more than one of these mechanisms
will be rejected by the endpoint. This avoids the need to define a precedence
between the authentication schemes to determine what happens when different
mechanisms would lead to a different authentication outcome for the same
request. An exception to this rule is made for the proprietary <code class="docutils literal notranslate"><span class="pre">RDFox</span></code>
authentication scheme (see <a class="reference internal" href="#rest-rdfox-authentication"><span class="std std-numref">Section 16.2.1.1.4</span></a>) which may be
used on a connection that is already authenticated using a client certificate
(see <a class="reference internal" href="#rest-client-certificates"><span class="std std-numref">Section 16.2.1.1.3</span></a>).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To protect against unauthorized disclosure of authentication secrets such as
passwords or bearer tokens, RDFox REST authentication should always be used
with Transport Layer Security (TLS) or restricted to localhost. See the
<code class="docutils literal notranslate"><span class="pre">channel</span></code> variable and related variables in <a class="reference internal" href="rdfox-endpoint.html#endpoint-parameters"><span class="std std-numref">Section 19.2</span></a>
for details of how to set up TLS.</p>
</div>
<div class="section" id="standard-http-authentication-schemes">
<span id="rest-http-authentication-schemes"></span><h5><span class="section-number">16.2.1.1.1. </span>Standard HTTP Authentication Schemes<a class="headerlink" href="#standard-http-authentication-schemes" title="Permalink to this headline">¶</a></h5>
<p>The RESTful API supports various standard HTTP authentication schemes in
accordance with <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc7235">rfc7235</a>.
Under this standard, authentication information is included in each request via
the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header. The structure of the header is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Authorization: &lt;auth-scheme&gt; &lt;authorization-parameters&gt;
</pre></div>
</div>
<p>When this header is present, the endpoint will attempt to match
<code class="docutils literal notranslate"><span class="pre">&lt;auth-scheme&gt;</span></code> to one the RDFox server’s configured authentication managers.
If no match is found, the request is rejected with status code <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">-</span>
<span class="pre">Unauthorized</span></code>; otherwise, the <code class="docutils literal notranslate"><span class="pre">&lt;authorization-parameters&gt;</span></code> are passed to the
matching authentication manager for verification. For more detail on the
process of authentication, see <a class="reference internal" href="access-control.html#authentication-managers"><span class="std std-numref">Section 12.3</span></a>. The table
below shows the supported schemes and the corresponding authentication manager
name for use with the <code class="docutils literal notranslate"><span class="pre">authentication-managers</span></code> <a class="reference internal" href="servers.html#authentication-managers-server-param"><span class="std std-ref">server parameter</span></a>.</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>Authentication Manager Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Basic</span></code></p></td>
<td><p><a class="reference internal" href="access-control.html#role-name-password"><span class="std std-ref">role-name+password</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Bearer</span></code></p></td>
<td><p><a class="reference internal" href="access-control.html#oidc"><span class="std std-ref">oidc</span></a></p></td>
</tr>
</tbody>
</table>
<p>Clients can discover the list of standard HTTP authentication schemes
configured at a particular RDFox server by sending a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request with path
<code class="docutils literal notranslate"><span class="pre">/authentication</span></code> to the server’s endpoint. The response is written as the
output of a SPARQL query that returns one answer per enabled authentication
manager with variable <code class="docutils literal notranslate"><span class="pre">?SchemeName</span></code> bound to the scheme name supported by the
manager. Two additional variables include more information about the scheme.</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CredentialsSupported</span></code></p></td>
<td><p>Whether the client can provide credentials in the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header or not.
Possible values are <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SessionType</span></code></p></td>
<td><p>Support for session-based authentication (<a class="reference internal" href="#rest-sessions"><span class="std std-numref">Section 16.2.1.1.2</span></a>).
Possible values are:</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;interactive-login&quot;</span></code> - sessions are supported, requiring an initial call
to <code class="docutils literal notranslate"><span class="pre">/login/initiate</span></code> before the call to <code class="docutils literal notranslate"><span class="pre">/login/complete</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;direct-login&quot;</span></code> - sessions are supported, requiring a call
to <code class="docutils literal notranslate"><span class="pre">/login/complete</span></code> with no initial call to <code class="docutils literal notranslate"><span class="pre">/login/initiate</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code> - sessions are not supported, for example when the <code class="docutils literal notranslate"><span class="pre">oidc</span></code>
authentication manager is configured without a <code class="docutils literal notranslate"><span class="pre">client-secret</span></code> (in which case the
<code class="docutils literal notranslate"><span class="pre">Bearer</span></code> scheme can only be used with the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header).</p>
</td>
</tr>
</tbody>
</table>
<p>This is demonstrated in the following example.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/authentication</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 20 Nov 2024 21:14:26 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/tab-separated-values; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

?SchemeName ?CredentialsSupported   ?SessionType
&quot;Basic&quot;  true  &quot;direct-login&quot;
&quot;Bearer&quot; true  &quot;interactive-login&quot;
</pre></div>
</div>
<p>There is no equivalent of this API in Java.</p>
</div>
<div class="section" id="session-based-authentication">
<span id="rest-sessions"></span><h5><span class="section-number">16.2.1.1.2. </span>Session-Based Authentication<a class="headerlink" href="#session-based-authentication" title="Permalink to this headline">¶</a></h5>
<p>This section describes how to begin and end sessions with the RDFox endpoint
and also includes details about the encryption of session tokens.</p>
<p>Beginning a new session (logging in) is achieved by making a successful login
completion API call using one of the server’s configured authentication
managers (see the <code class="docutils literal notranslate"><span class="pre">authentication-managers</span></code> <a class="reference internal" href="servers.html#server-parameters"><span class="std std-ref">server parameter</span></a>). When using the <code class="docutils literal notranslate"><span class="pre">oidc</span></code> authentication manager, it is
necessary to first initiate the login process with a separate login initiation
API call.</p>
<p>Login initiation is performed by sending a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to path
<code class="docutils literal notranslate"><span class="pre">/authentication/login/initiate</span></code> with an <code class="docutils literal notranslate"><span class="pre">authentication-scheme</span></code> query
parameter specifying one of the standard HTTP authentication schemes listed in
<a class="reference internal" href="#rest-http-authentication-schemes"><span class="std std-numref">Section 16.2.1.1.1</span></a> and a set of key-value pairs encoded
in the request body according to the <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>
format. The table below links to the relevant documentation section for each
authentication scheme.</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 7%" />
<col style="width: 21%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Authentication Manager</p></th>
<th class="head"><p>Supported Authentication Scheme</p></th>
<th class="head"><p>Documentation Section for Session Support</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">role-name+password</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Basic</span></code></p></td>
<td><p><a class="reference internal" href="access-control.html#role-name-password-session-authentication"><span class="std std-numref">Section 12.3.1.2</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">oidc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Bearer</span></code></p></td>
<td><p><a class="reference internal" href="access-control.html#oidc-session-authentication"><span class="std std-numref">Section 12.3.2.2</span></a></p></td>
</tr>
</tbody>
</table>
<p>The request must not have any associated authentication information (e.g., no
<code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header, client certificate, existing session, or login
state). Upon success, RDFox will return a <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> response with a
<code class="docutils literal notranslate"><span class="pre">Location</span></code> header specifying the next URL to use in the login process, a
temporary cookie containing the encrypted login state, and a response body also
containing the login state. This step is demonstrated by the following example.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/authentication/login/initiate?authentication-scheme=bearer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">51</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

<span class="nt">completion-uri</span><span class="o">=</span><span class="s">https%3A%2F%2Fexample.com%2Fcallback</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 23 Oct 2024 19:17:49 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-LoginID=fffffffff; Path=/; HttpOnly; SameSite=Strict; Secure</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://login.example.com/authorize?response_type=code...</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">24</span>

ffffffffffffffffffffffff
</pre></div>
</div>
<p>If the client wants to cancel the login attempt after an
<code class="docutils literal notranslate"><span class="pre">authentication/login/initiate</span></code> call, the client should send a <code class="docutils literal notranslate"><span class="pre">POST</span></code>
request to the <code class="docutils literal notranslate"><span class="pre">/authentication/login/cancel</span></code> endpoint. The request must
contain the <code class="docutils literal notranslate"><span class="pre">RDFox-LoginID</span></code> cookie received in the initiation response in a
<code class="docutils literal notranslate"><span class="pre">Cookie</span></code> header. The request must not have an <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header or a
client certificate. Upon success, RDFox will return a <code class="docutils literal notranslate"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code>
response with a <code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> header unsetting the temporary <code class="docutils literal notranslate"><span class="pre">RDFox-LoginID</span></code>
cookie. The client may want to cancel the login process for several reasons,
such as, if an error was encountered during the login process with the OIDC
provider and they want to reset the login process. This step is demonstrated in
the following example.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/authentication/login/cancel</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">RDFox-LoginID=fffffffff</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No content</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Mon, 02 Dec 2024 10:56:32 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-LoginID=; Path=/; Max-Age=0; HttpOnly; SameSite=Strict;</span>
</pre></div>
</div>
<p>After receiving the initiation response, the client should then follow the URL
returned in the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header to proceed with the login. If the user
agent is a web browser, the browser will automatically handle the redirection.</p>
<p>Login completion is performed by sending a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to path
<code class="docutils literal notranslate"><span class="pre">/authentication/login/complete</span></code> with an <code class="docutils literal notranslate"><span class="pre">authentication-scheme</span></code> query
parameter specifying one of the standard HTTP authentication schemes listed in
<a class="reference internal" href="#rest-http-authentication-schemes"><span class="std std-ref">Standard HTTP Authentication Schemes</span></a>. If the completion call is part of a
login attempt that began with a login initiation call, the request must use the
same value for the <code class="docutils literal notranslate"><span class="pre">authentication-scheme</span></code> query parameter, and must include
the <code class="docutils literal notranslate"><span class="pre">RDFox-LoginID</span></code> cookie received in the initiation response in a
<code class="docutils literal notranslate"><span class="pre">Cookie</span></code> header. Additionally, the request must include the authentication
parameters required by the associated authentication manager as key-value pairs
encoded in the request body according to the
<code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> format.</p>
<p>Upon success, RDFox will return a <code class="docutils literal notranslate"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code> response with
<code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> headers unsetting the temporary <code class="docutils literal notranslate"><span class="pre">RDFox-LoginID</span></code> cookie and
setting the longer-lived <code class="docutils literal notranslate"><span class="pre">RDFox-SID</span></code> cookie to the new session token. This
cookie can be used to authenticate subsequent requests to the server.</p>
<p>The following example demonstrates the completion of the login attempt that was
initiated in the previous example.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/authentication/login/complete?authentication-scheme=bearer</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">RDFox-LoginID=fffffffff</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">48</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

<span class="nt">code</span><span class="o">=</span><span class="s">CCCCCCCCCCCC</span><span class="p">&amp;</span><span class="nt">state</span><span class="o">=</span><span class="s">ffffffffffffffffffffffff</span><span class="p">&amp;</span><span class="nt">completion-uri</span><span class="o">=</span><span class="s">https%3A%2F%2Fexample.com%2Fcallback</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 23 Oct 2024 19:37:30 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-LoginID=; Path=/; Max-Age=0; HttpOnly; SameSite=Strict</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-SID=AAAAAAAAAAAA; Path=/; HttpOnly; SameSite=Strict; Secure</span>
</pre></div>
</div>
<p>The session token should be included as a cookie on subsequent requests. At any
point, the server may decide to refresh the session token, in which case
response will contain an <code class="docutils literal notranslate"><span class="pre">RDFox-SID</span></code> cookie with a new refresh token value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/DS1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">RDFox-SID=AAAAAAAAAAAA</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 23 Oct 2024 19:39:22 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-SID=BBBBBBBBBBBB; Path=/; HttpOnly; SameSite=Strict</span>

&lt;response to the GET request&gt;
</pre></div>
</div>
<p>To end a session (log out), the client should send a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the
<code class="docutils literal notranslate"><span class="pre">/authentication/logout</span></code> to destroy any server-side session state and unset
the session cookie. This is demonstrated in the following example.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/authentication/logout</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">RDFox-SID=BBBBBBBBBBBB</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 23 Oct 2024 19:39:22 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Set-Cookie</span><span class="o">:</span> <span class="l">RDFox-SID=; Path=/; Max-Age=0; HttpOnly; SameSite=Strict</span>
</pre></div>
</div>
<p>Session tokens contain information encrypted with a server-side key. For this
reason, using the session-based authentication mechanisms described in this
section requires <code class="docutils literal notranslate"><span class="pre">libcrypto</span></code> from the <a class="reference external" href="https://www.openssl.org/">OpenSSL</a>
package (see <a class="reference internal" href="features-and-requirements.html#third-party-software"><span class="std std-numref">Section 2.4.1.2</span></a> for more detail). The key and
algorithm to encrypt and decrypt session tokens may be specified explicitly via
the <code class="docutils literal notranslate"><span class="pre">session.encryption.key</span></code> and <code class="docutils literal notranslate"><span class="pre">session.encryption.algorithm</span></code>
<a class="reference internal" href="servers.html#server-parameters"><span class="std std-ref">server parameters</span></a> or via the
<code class="docutils literal notranslate"><span class="pre">persistence.encryption.key</span></code> and <code class="docutils literal notranslate"><span class="pre">persistence.encryption.algorithm</span></code>
parameters. If no key is specified by the above parameters, a key is randomly
generated and used for the server session. This means that session tokens are
invalidated when the server is restarted and users will be forced to log in
again. This option requires</p>
</div>
<div class="section" id="authentication-with-client-certificates">
<span id="rest-client-certificates"></span><h5><span class="section-number">16.2.1.1.3. </span>Authentication with Client Certificates<a class="headerlink" href="#authentication-with-client-certificates" title="Permalink to this headline">¶</a></h5>
<p>When using TLS, the RDFox endpoint will request a certificate from the client
during the handshake if the <code class="docutils literal notranslate"><span class="pre">request-client-certificates</span></code> <a class="reference internal" href="rdfox-endpoint.html#endpoint-parameters"><span class="std std-ref">endpoint
parameter</span></a> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. The client is free to
ignore this request and continue with the handshake without providing a
certificate, in which case the TLS session will be established with no
associated authentication information. If the client does provide a
certificate, the certificate will be verified against the loaded trust anchors
(sometimes referred to as “root certificates”). If verification fails, the
transport layer connection will be closed immediately. Otherwise, the TLS
session is established with authentication information extracted from the
certificate. Specifically, the first common name (CN) and the list of
organizational units (OUs) for the certificate’s subject, as well as the
notBefore and notAfter date-times are extracted.</p>
<p>When an HTTP request requiring authentication is received within an established
TLS session, and there is no <code class="docutils literal notranslate"><span class="pre">RDFox</span></code> authentication token, the TLS session
will be inspected to see if it has any associated authentication information.
If so, and the information includes one or more organizational units, the
endpoint will compile the privileges for the certificate subject as an external
agent, as described in <a class="reference internal" href="access-control.html#effective-privileges-external-agent"><span class="std std-numref">Section 12.2.1.3</span></a>, passing
the list of organizational units as the list of roles. If no organizational
units are present, the endpoint will instead attempt to complete the
authentication process using <a class="reference internal" href="access-control.html#direct-role-retrieval"><span class="std std-ref">direct role retrieval</span></a>, passing the common name as the role name.</p>
<p>Verification of certificates is performed using the default trust anchors for
the OpenSSL library in use. An additional certificate can be supplied via the
<code class="docutils literal notranslate"><span class="pre">trusted-root-certificate</span></code> or <code class="docutils literal notranslate"><span class="pre">trusted-root-certificate-file</span></code> parameter.
When verification of a client certificate fails and the connection is
immediately closed, the verification error message will be logged in the
<code class="docutils literal notranslate"><span class="pre">x-protocol-error</span></code> field of Extended Log Format (ELF) logger, if it is in
use.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RDFox does not support checking of certificate revocation lists (CRLs).</p>
</div>
</div>
<div class="section" id="rdfox-authentication">
<span id="rest-rdfox-authentication"></span><h5><span class="section-number">16.2.1.1.4. </span>RDFox Authentication<a class="headerlink" href="#rdfox-authentication" title="Permalink to this headline">¶</a></h5>
<p>For each named object managed by the endpoint such as connections and shells,
the endpoint generates a matching authentication token that can be used to
authenticate requests to use or managing that object. This is described in more
detail in both <a class="reference internal" href="#rest-explicit-connection-management"><span class="std std-numref">Section 16.2.5</span></a> and
<a class="reference internal" href="#rest-explicit-shell-management"><span class="std std-numref">Section 16.20.2</span></a>.</p>
</div>
<div class="section" id="anonymous-requests-and-the-guest-role">
<span id="rest-guest-role"></span><h5><span class="section-number">16.2.1.1.5. </span>Anonymous Requests and the <code class="docutils literal notranslate"><span class="pre">guest</span></code> role<a class="headerlink" href="#anonymous-requests-and-the-guest-role" title="Permalink to this headline">¶</a></h5>
<p>Upon receiving a REST request with no <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header or
TLS-authenticated role name, the RDFox endpoint will attempt to authenticate as
role <code class="docutils literal notranslate"><span class="pre">guest</span></code>. If this authentication succeeds, the endpoint will then
continue processing the request using the resulting <a class="reference internal" href="connections.html#connections"><span class="std std-ref">connection</span></a>. The level of access to an RDFox server available via anonymous
(i.e. unauthenticated) requests can therefore be controlled by granting the
appropriate privileges to the <code class="docutils literal notranslate"><span class="pre">guest</span></code> role or, in the case that all requests
should be authenticated, ensuring that <code class="docutils literal notranslate"><span class="pre">guest</span></code> is not one of the server’s
roles.</p>
</div>
</div>
<div class="section" id="retrieving-the-current-authentication-status">
<h4><span class="section-number">16.2.1.2. </span>Retrieving the Current Authentication Status<a class="headerlink" href="#retrieving-the-current-authentication-status" title="Permalink to this headline">¶</a></h4>
<p>In some cases, it is useful for client applications to know which agent is
currently authenticated and how. This can be determined by sending a <code class="docutils literal notranslate"><span class="pre">GET</span></code>
request to path <code class="docutils literal notranslate"><span class="pre">/authentication/self</span></code>. If no agent is authenticated on the
connection, a <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">Unauthorized</span></code> response is returned. Otherwise, the
response is written as the output of a SPARQL query that binds the variable
<code class="docutils literal notranslate"><span class="pre">?agent-name</span></code> to the name of the agent, variable <code class="docutils literal notranslate"><span class="pre">?agent-type</span></code> to the type
of the agent (either <code class="docutils literal notranslate"><span class="pre">role</span></code> or <code class="docutils literal notranslate"><span class="pre">external-agent</span></code>), and variable
<code class="docutils literal notranslate"><span class="pre">?authentication-route</span></code> to the authentication mechanism that was used (one of
<code class="docutils literal notranslate"><span class="pre">authorization-header</span></code>, <code class="docutils literal notranslate"><span class="pre">session-cookie</span></code>, <code class="docutils literal notranslate"><span class="pre">tls-certificate</span></code>, <code class="docutils literal notranslate"><span class="pre">guest</span></code>).</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/authentication/self</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:12110</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Mon, 21 Oct 2024 14:17:11 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/tab-separated-values; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

?Property    ?Value
&quot;agent-name&quot; &quot;guest&quot;
&quot;agent-type&quot; &quot;role&quot;
&quot;authentication-route&quot;       &quot;guest&quot;
</pre></div>
</div>
<p>As HTTP is a stateless protocol, the authentication status returned by the
above API call is only correct for the request itself. It is therefore
essential that any client presenting a “logged in” state to an end user based
on the information returned by the above API, ensures that calls it makes to
the other APIs documented on this page are sent with the same authentication
information.</p>
</div>
</div>
<div class="section" id="suppressing-the-www-authenticate-response-header">
<h3><span class="section-number">16.2.2. </span>Suppressing the WWW-Authenticate response header<a class="headerlink" href="#suppressing-the-www-authenticate-response-header" title="Permalink to this headline">¶</a></h3>
<p>In accordance with <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc7235">rfc7235</a>, RDFox includes a
<code class="docutils literal notranslate"><span class="pre">WWW-Authenticate</span></code> header, detailing available authentication options, in any <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">(Unauthorized)</span></code>
response. A REST client may prevent RDFox including this header in such a response by including
the header <code class="docutils literal notranslate"><span class="pre">RDFox-Suppress-Basic-WWW-Authenticate:</span> <span class="pre">true</span></code> in the request.</p>
</div>
<div class="section" id="treating-get-results-as-answers-to-sparql-queries">
<span id="apis-treating-get-results-as-answers-to-sparql-queries"></span><h3><span class="section-number">16.2.3. </span>Treating <code class="docutils literal notranslate"><span class="pre">GET</span></code> Results as Answers to SPARQL Queries<a class="headerlink" href="#treating-get-results-as-answers-to-sparql-queries" title="Permalink to this headline">¶</a></h3>
<p>Many RESTful API calls return information about various parts of the data
store. For example, one can list all data stores in a server, all data sources
in a data store, and so on. In order to avoid introducing additional formats,
the output of all such requests are formatted as answers to certain SPARQL
queries. (This does not mean that such a query can be evaluated through a
SPARQL endpoint; rather, it only means that the same result format is reused to
represent query results.)</p>
<p>Answers of such queries can be serialized using any of the supported query
answer formats (see <a class="reference internal" href="querying.html#query-answer-formats"><span class="std std-numref">Section 9.1.2</span></a>) apart from
<code class="docutils literal notranslate"><span class="pre">application/sparql-results+resourceid</span></code>.</p>
<p>Content negotiation determines the format to be used, as usual in the <a class="reference external" href="http://www.w3.org/TR/sparql11-protocol/">SPARQL
1.1 protocol</a>. The examples in this
document use the CSV format for simplicity. All such calls accept an optional
parameter with name <code class="docutils literal notranslate"><span class="pre">filter</span></code>, whose value must be a SPARQL 1.1 <code class="docutils literal notranslate"><span class="pre">FILTER</span></code>
expression. If a filter expression is specified, it is evaluated for each
answer in the list, and only those answers on which the expression returns
<code class="docutils literal notranslate"><span class="pre">true</span></code> are returned.</p>
</div>
<div class="section" id="restful-connections-and-transactions">
<span id="rest-implicit-connections-and-transactions"></span><h3><span class="section-number">16.2.4. </span>RESTful Connections and Transactions<a class="headerlink" href="#restful-connections-and-transactions" title="Permalink to this headline">¶</a></h3>
<p>Just like in the Java API, each RESTful API request is also evaluated within a
context of a server or a data store <a class="reference internal" href="connections.html#connections"><span class="std std-ref">connection</span></a>. The
RESTful endpoint provides two ways of associating a connection with each
request.</p>
<ul class="simple">
<li><p>If no connection management headers are present in the HTTP request, each
request will be evaluated in the context of a fresh connection. This provides
users with a convenient way of using the RESTful API without any complication
with connection management, which is arguably not natural in a connectionless
protocol such as HTTP.</p></li>
<li><p>By including a <code class="docutils literal notranslate"><span class="pre">connection</span></code> HTTP request parameter, users can specify that
the request should be evaluated within a specific connection. In such a case,
a connection can be understood as a session: creating a connection requires
checking the caller’s credentials, and subsequent requests on this connection
are performed with the credentials associated with the connection. Moreover,
connections can be used to support user-controlled transactions. Finally, the
RESTful API provides calls for managing server and data store connections.</p></li>
</ul>
<p>Most RESTful API calls are evaluated inside a read-only or a read/write
transaction, which is started implicitly whenever the underlying connection is
not already associated with a transaction. Depending on the workload, starting
a transaction may take a long period of time. In order to prevent API calls
from being blocked indefinitely, the RESTful API will cancel a request and
report an error if the transaction cannot be acquired within a predetermined
time period (which is currently hard-coded to two seconds).</p>
</div>
<div class="section" id="explicit-connection-management">
<span id="rest-explicit-connection-management"></span><h3><span class="section-number">16.2.5. </span>Explicit Connection Management<a class="headerlink" href="#explicit-connection-management" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">/connections</span></code> key can be used to manage server connections, and the
<code class="docutils literal notranslate"><span class="pre">/datastores/&lt;DSTRNAME&gt;/connections</span></code> key is used to manage connections to
data store <code class="docutils literal notranslate"><span class="pre">&lt;DSTRNAME&gt;</span></code>. Both provide exactly the same API, so all examples
in the rest of this section are presented for the latter connection type. All
examples assume that a data store called <code class="docutils literal notranslate"><span class="pre">myStore</span></code> has been created in the
server.</p>
<p>The following request creates a connection to data store called <code class="docutils literal notranslate"><span class="pre">myStore</span></code>.
The connection is identified by a identifier, which is returned in the
<code class="docutils literal notranslate"><span class="pre">Location</span></code> response header. The newly created connection is associated with
the role specified in the request; that is, if provided, the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code>
header specifies the role name and password, and otherwise the guest role is
used. The response will also contain a <code class="docutils literal notranslate"><span class="pre">RDFox-Authentication-Token</span></code> header,
which will contain another random value that should be used for authentication
on the connection as described below; since this value is used for
authentication, measures should be taken to keep it secret.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/connections</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">RDFox-Authentication-Token</span><span class="o">:</span> <span class="l">11111222223333344444</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/connections/01234567890123456789</span>
</pre></div>
</div>
<p>Any RESTful API request that requires a data store connection can now be
performed on a specific connection by including the connection ID as the value
of the <code class="docutils literal notranslate"><span class="pre">connection</span></code> request parameter. For example, the following request
will import the data into the data store using the connection created above.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content?connection=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[The facts/rules to be added in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Response body as usual]
</pre></div>
</div>
<p>All such requests are performed with the role associated with the connection.
RDFox provides two ways of making sure that such requests are indeed issued by
the appropriate user.</p>
<ul class="simple">
<li><p>One can use basic authentication to supply a role name and password. For the
request to succeed, the role name must match the name of the role logged into
the connection, and the password must be valid for the role at the time the
request is serviced.</p></li>
<li><p>Alternatively, one can use RDFox authentication scheme by including the
header <code class="docutils literal notranslate"><span class="pre">Authorization:</span> <span class="pre">RDFox</span> <span class="pre">&lt;token&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;token&gt;</span></code> is the
authentication token returned when the connection was created. For example,
the above request can be issued as follows:</p></li>
</ul>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content?connection=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">RDFox 11111222223333344444</span>

[The facts/rules to be added in a format supported by RDFox]
</pre></div>
</div>
<p>Created connections can be managed using the
<code class="docutils literal notranslate"><span class="pre">/datastores/&lt;DSTRNAME&gt;/connections/&lt;DSCONN&gt;</span></code> key. A <code class="docutils literal notranslate"><span class="pre">GET</span></code> request on the
connection provides information about the connection. The response is written
as the output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the
property name, variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the property value, and variable
<code class="docutils literal notranslate"><span class="pre">?Mutable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> if the value of the property can be changed and to
<code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise. At present, <code class="docutils literal notranslate"><span class="pre">role-name</span></code> is the only property associated
with the connection, and its value reflects the name of the role associated
with the connection.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/connections/01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value,Mutable
role-name,guest,false
</pre></div>
</div>
<p>A connection can be deleted using a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/connections/01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">RDFox 11111222223333344444</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request can be used to interrupt another request currently running
on the connection, or to duplicate the connection. The type of request is
specified in the <code class="docutils literal notranslate"><span class="pre">operation</span></code> request parameter. When checking the role
password, the request body specifies the password of the new role. The
remaining connection operations accept no parameters and the request body must
be empty.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/connections/01234567890123456789?operation=interrupt</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/connections/01234567890123456789?operation=duplicate</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/connections/98765432109876543210</span>
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">GET</span></code> on <code class="docutils literal notranslate"><span class="pre">/datastores/myStore/connections</span></code> lists the connections
to data store <code class="docutils literal notranslate"><span class="pre">myStore</span></code>. The response is written as the output of a SPARQL
query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the connection identifier.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/connections</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name
01234567890123456789
98765432109876543210
</pre></div>
</div>
<p>Server connections are managed in exactly the same way.</p>
<div class="section" id="connections-and-concurrency">
<h4><span class="section-number">16.2.5.1. </span>Connections and Concurrency<a class="headerlink" href="#connections-and-concurrency" title="Permalink to this headline">¶</a></h4>
<p>Access to connections in the RESTful API is serialized: if two requests
attempts to access the same connection, one of request will fail in order to
safeguard the integrity of the RDFox server. To use RDFox concurrently from
multiple requests, one should use distinct connections. Without explicit
connection management, this is automatically achieved by creating a temporary
connection to service each request.</p>
</div>
<div class="section" id="connection-expiry">
<h4><span class="section-number">16.2.5.2. </span>Connection Expiry<a class="headerlink" href="#connection-expiry" title="Permalink to this headline">¶</a></h4>
<p>Since the RESTful API is connectionless, there is no way to associate a data
store or server connection with a physical network connection to the server. In
order to avoid situations where a connection is created but never deleted, the
RESTful API will delete a connection if it has not been used (i.e., no HTTP
request accessed it) for a period longer than the value of the
<code class="docutils literal notranslate"><span class="pre">object-keep-alive-time</span></code> endpoint parameter. That is, a connection will remain
valid for at least that much time (but it may actually remain valid slightly
longer).</p>
</div>
</div>
<div class="section" id="management-of-restful-requests">
<h3><span class="section-number">16.2.6. </span>Management of RESTful Requests<a class="headerlink" href="#management-of-restful-requests" title="Permalink to this headline">¶</a></h3>
<p>Most requests running on the RESTful endpoint are assigned a request ID for the
duration of the request’s execution. This ID can be used to inspect and cancel
the request. The ID is assigned in one of the following two ways.</p>
<ul class="simple">
<li><p>If no request ID is specified by the user, RDFox will use a unique ID for
each such request.</p></li>
<li><p>Users can associate a request with an ID using the <code class="docutils literal notranslate"><span class="pre">RDFox-Request-ID</span></code>
header. In this way, the ID is known to the user and so the user can cancel
the request without having to first identify the request in the list of
running requests. RDFox <em>will not</em> check that the ID used by the user is
unique: if two requests are submitted with the same ID, both physical HTTP
requests will be considered part of one logical request. This can be useful
in applications: if several physical HTTP requests should be cancelled as a
unit, using the same request ID for all of them simplifies cancellation
logic. Thus, users should use a method with high entropy (such as GUIDs) to
generate unique request IDs.</p></li>
</ul>
<p>The following example illustrates how to associate a user-generated request ID
with a request to the RDFox endpoint.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/sparql?query=SELECT+%3FX+%3FY+%3FZ+WHERE+{+%3FX+%3FY+%3FZ+}</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">RDFox-Request-ID</span><span class="o">:</span> <span class="l">fe12f5fb-068e-4c4f-aee5-9799a3b230b0</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">/requests</span></code> key provides a method for inspecting and cancelling running
requests. In particular, <code class="docutils literal notranslate"><span class="pre">GET</span></code> on <code class="docutils literal notranslate"><span class="pre">/requests</span></code> lists the requests running on
the server. The response is written as the output of a SPARQL query that binds
the variables <code class="docutils literal notranslate"><span class="pre">?RequestID</span></code>, <code class="docutils literal notranslate"><span class="pre">?StartTime</span></code>, <code class="docutils literal notranslate"><span class="pre">?RoleName</span></code>, <code class="docutils literal notranslate"><span class="pre">?Method</span></code>, and
<code class="docutils literal notranslate"><span class="pre">?Target</span></code> to the request ID, the start time of the request, the name of the
role that submitted the request, and the HTTP method and target, respectively.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/requests</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

RequestID,StartTime,RoleName,Method,Target
fe12f5fb-068e-4c4f-aee5-9799a3b230b0,guest,POST,/datastores/myStore/sparql?query=SELECT+%3FX+%3FY+%3FZ+WHERE+{+%3FX+%3FY+%3FZ+}
...
</pre></div>
</div>
<p>Information about a particular request can be obtained by <code class="docutils literal notranslate"><span class="pre">GET</span></code> on
<code class="docutils literal notranslate"><span class="pre">/requests/&lt;REQID&gt;</span></code>. The response is written as the output of a SPARQL query
that binds the variables <code class="docutils literal notranslate"><span class="pre">?Property</span></code> and <code class="docutils literal notranslate"><span class="pre">?Value</span></code> for various properties
and values, respectively, of the request. If several physical HTTP requests
with the same ID are running, information about all of them is returned.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/requests/fe12f5fb-068e-4c4f-aee5-9799a3b230b0</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
request-id,fe12f5fb-068e-4c4f-aee5-9799a3b230b0
start-time,2023-06-16T17:06:00+01:00
role-name,guest
method,POST
target,/datastores/myStore/sparql?query=SELECT+%3FX+%3FY+%3FZ+WHERE+{+%3FX+%3FY+%3FZ+}
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> with a particular request ID cancels all physical HTTP
requests associated with the same ID.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/requests/fe12f5fb-068e-4c4f-aee5-9799a3b230b0</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>Cancelling running requests is a complex asynchronous operation that is
provided on a best effort basis. RDFox will try its best to cancel a running
request, but it cannot provide hard guarantees that cancellation will be
immediate, or in fact that it will succeed eventually.</p>
<p>Request management operations are subject to access control rules that are
described in <a class="reference internal" href="access-control.html#request-access-control"><span class="std std-numref">Section 12.1.6.2.3</span></a>. Each operation mentioned in this
section is performed against the subset of all requests that the role is
authorised for. For example, when listing requests, all requests (if any) will
be included into the list that the role has the read privilege for.</p>
</div>
</div>
<div class="section" id="managing-servers">
<h2><span class="section-number">16.3. </span>Managing Servers<a class="headerlink" href="#managing-servers" title="Permalink to this headline">¶</a></h2>
<p>This section describes the API calls responsible for managing an RDFox server.</p>
<div class="section" id="retrieving-server-properties">
<h3><span class="section-number">16.3.1. </span>Retrieving Server Properties<a class="headerlink" href="#retrieving-server-properties" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves standard properties of a server. The response
is written as the output of a SPARQL query that binds the variable
<code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the property name, variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the property value,
and variable <code class="docutils literal notranslate"><span class="pre">?Mutable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> if the value of the property can be
changed and to <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise. The names of all properties specified at
the time the server was created are prefixed with <code class="docutils literal notranslate"><span class="pre">parameters.</span></code> so that they
can be identified in the output.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value,Mutable
version,5.7,false
git-SHA,74840e53a04b64af24538483163d3aabb7a04c7e,false
max-memory,100000000,true
available-memory,80000000,false
num-threads,8,true
parameters.max-memory,100000000,false
</pre></div>
</div>
<p>The Java API provides various getter functions on <code class="docutils literal notranslate"><span class="pre">ServerConnection</span></code> to
retrieve the properties of a server.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">numThreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">getNumberOfThreads</span><span class="p">();</span>
<span class="c1">// ...</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-server-properties">
<h3><span class="section-number">16.3.2. </span>Setting Server Properties<a class="headerlink" href="#setting-server-properties" title="Permalink to this headline">¶</a></h3>
<p>The following request updates the server properties using the values specified
in the request. Only properties names returned in a <code class="docutils literal notranslate"><span class="pre">GET</span></code> call from the
previous section are supported, and only mutable properties can be changed.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/?operation=set&amp;num-threads=5</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>The Java API provides various setter functions on <code class="docutils literal notranslate"><span class="pre">ServerConnection</span></code> to set
the properties of a server.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">numberOfThreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">sConn</span><span class="p">.</span><span class="na">setNumberOfThreads</span><span class="p">(</span><span class="n">numberOfThreads</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-server-integrity">
<span id="apis-checking-server-integrity"></span><h3><span class="section-number">16.3.3. </span>Checking Server Integrity<a class="headerlink" href="#checking-server-integrity" title="Permalink to this headline">¶</a></h3>
<p>The following request checks the integrity of the server in the same was as the
<a class="reference internal" href="rdfox-shell.html#checkintegrity-command"><span class="std std-ref">checkintegrity</span></a> command. The number of errors of the same type to
report can be determined using the optional <code class="docutils literal notranslate"><span class="pre">max-errors-of-same-type</span></code> query
parameter. In order to allow clients to track the progress, the response is
continuously streamed to the clients. Furthermore, since the HTTP status code
must be produced before the response body, the HTTP status code is always <code class="docutils literal notranslate"><span class="pre">200</span>
<span class="pre">OK</span></code>. If the check fails and trailers are enabled, the trailer will contain the
<code class="docutils literal notranslate"><span class="pre">RDFox-Final-Status-Code</span></code> field with the code <code class="docutils literal notranslate"><span class="pre">500</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/?operation=check-integrity&amp;max-errors-of-same-type=25</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>

Running the server integrity check.
...
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">errorsDetected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">checkIntegrity</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="n">outputStream</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-data-stores">
<h2><span class="section-number">16.4. </span>Managing Data Stores<a class="headerlink" href="#managing-data-stores" title="Permalink to this headline">¶</a></h2>
<p>This section describes the API calls responsible for managing data stores of an
RDFox server.</p>
<div class="section" id="listing-available-data-stores">
<h3><span class="section-number">16.4.1. </span>Listing Available Data Stores<a class="headerlink" href="#listing-available-data-stores" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of data stores available at a server.
The response is written as an output of a SPARQL query that, for each data
store, binds variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of the data store. Variables
<code class="docutils literal notranslate"><span class="pre">?UniqueID</span></code>, <code class="docutils literal notranslate"><span class="pre">?Persistent</span></code>, <code class="docutils literal notranslate"><span class="pre">?Online</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Parameters</span></code> are also returned.
However, these variables are optional, and are bound only if the user has read
privilege over the data store in question (otherwise returning <code class="docutils literal notranslate"><span class="pre">UNDEF</span></code>).
If the user does have the necessary privileges, the <code class="docutils literal notranslate"><span class="pre">?UniqueID</span></code> variable
is bound to the data store unique ID, the <code class="docutils literal notranslate"><span class="pre">?Persistent</span></code> variable is bound to a
boolean value indicating whether the data store is persistent, the <code class="docutils literal notranslate"><span class="pre">?Online</span></code>
variable is bound to a boolean value indicating whether the data store is online,
and variable <code class="docutils literal notranslate"><span class="pre">?Parameters</span></code> is bound to a string containing the data store parameters.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,UniqueID,Persistent,Online,Parameters
DataStore1,01234567890123456789,false,true,init-resource-capacity=16384&amp;max-data-pool-size=10000000&amp;max-resource-capacity=1000000&amp;max-tuple-capacity=1000000&amp;type=parallel-nn
DataStore2,98765432109876543210,false,true,type=parallel-nn
DataStore3,,,,
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">DataStoreInfo</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">dataStoreInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">listDataStores</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-data-store-parameters">
<h3><span class="section-number">16.4.2. </span>Listing Data Store Parameters<a class="headerlink" href="#listing-data-store-parameters" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the parameters of a single data store that were
determined at data store creation. The response is written as an output of a
SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the property name, and
variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the property value. The names of all data store
parameters (see <a class="reference internal" href="data-stores.html#data-store-parameters"><span class="std std-numref">Section 5.4.1</span></a>) are prefixed with
<code class="docutils literal notranslate"><span class="pre">parameters.</span></code> so that they can be identified in the output.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/DataStore1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,TestDataStore
unique-id,01234567890123456789
persistent,false
online,true
parameters.init-resource-capacity,16384,false
parameters.max-data-pool-size,10000000,false
parameters.max-resource-capacity,1000000,false
parameters.max-tuple-capacity,1000000,false
parameters.type,parallel-nn,false
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataStoreInfo</span><span class="w"> </span><span class="n">dataStoreInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">describeDataStore</span><span class="p">(</span><span class="s">&quot;DataStore1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-data-store">
<h3><span class="section-number">16.4.3. </span>Creating a Data Store<a class="headerlink" href="#creating-a-data-store" title="Permalink to this headline">¶</a></h3>
<p>The following request creates a new data store. The data store name and any
optional data store parameters are specified as part of the request URL. The
location of the new store is returned in the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore?type=parallel-nn&amp;key1=val1&amp;key2=val2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val1&quot;</span><span class="p">);</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val2&quot;</span><span class="p">);</span>
<span class="n">sConn</span><span class="p">.</span><span class="na">createDataStore</span><span class="p">(</span><span class="s">&quot;myStore&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parallel-nn&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-data-store">
<h3><span class="section-number">16.4.4. </span>Deleting a Data Store<a class="headerlink" href="#deleting-a-data-store" title="Permalink to this headline">¶</a></h3>
<p>The following request deletes a data store.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">sConn</span><span class="p">.</span><span class="na">deleteDataStore</span><span class="p">(</span><span class="s">&quot;myStore&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Deleting a data store invalidates all connections to it — that is, any request
made on the connection will result in an error. However, all connections to the
deleted data store must still be explicitly closed in order to release all
system resources.</p>
</div>
<div class="section" id="bringing-a-data-store-offline-online">
<span id="apis-bringing-a-data-store-offline-online"></span><h3><span class="section-number">16.4.5. </span>Bringing a Data Store Offline/Online<a class="headerlink" href="#bringing-a-data-store-offline-online" title="Permalink to this headline">¶</a></h3>
<p>The following request brings a data store offline. The response is written as
an output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?OfflineRequestResult</span></code>
to a String. A value of <code class="docutils literal notranslate"><span class="pre">&quot;success&quot;</span></code> indicates that the data store was
successfully brought offline, while a value of <code class="docutils literal notranslate"><span class="pre">&quot;already-offline&quot;</span></code> indicates
that the data store was already offline. A value of
<code class="docutils literal notranslate"><span class="pre">&quot;failed-due-to-active-connections&quot;</span></code> indicates that the data store was not
brought offline as there are one or more data store connections currently open
to this data store.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore?operation=bring-offline</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

OfflineRequestResult
&quot;success&quot;
</pre></div>
</div>
<p><strong>Java API</strong></p>
<p>In the Java API, the possible responses are represented as as an enumeration
<code class="docutils literal notranslate"><span class="pre">OfflineRequestResult</span></code> with values <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">ALREADY_OFFLINE</span></code>, and
<code class="docutils literal notranslate"><span class="pre">FAILED_DUE_TO_ACTIVE_CONNECTIONS</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">OfflineRequestResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">bringDataStoreOffline</span><span class="p">(</span><span class="s">&quot;myStore&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The following request brings a data store online. The response is written as an
output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?WasOffline</span></code> to a Boolean
value specifying whether the data store was offline.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore?operation=bring-online</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

WasOffline
false
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">wasOffline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">bringDataStoreOnline</span><span class="p">(</span><span class="s">&quot;myStore&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="querying-data-store-state">
<h3><span class="section-number">16.4.6. </span>Querying Data Store State<a class="headerlink" href="#querying-data-store-state" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves information about the state of a data store.
The response is written as an output of a SPARQL query that binds the variable
<code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the property name, and variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the property
value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/DataStore1/info</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
data-store-version,42
requires-incremental-reasoning,true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">long</span><span class="w"> </span><span class="n">dataStoreVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getDataStoreVersionAfterLastOperation</span><span class="p">();</span>
<span class="n">bool</span><span class="w"> </span><span class="n">requiresIncrementalReasoning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">requiresIncrementalReasoning</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="querying-diagnostic-information">
<h3><span class="section-number">16.4.7. </span>Querying Diagnostic Information<a class="headerlink" href="#querying-diagnostic-information" title="Permalink to this headline">¶</a></h3>
<p>RDFox can report extensive diagnostic information about its internal
components, which is often useful during performance tuning and debugging.
Please note that this call is intended for diagnostic purposes only. The
information provided is determined by RDFox internals and is likely to change
in future versions of RDFox. Thus, applications should not rely on this
information being stable. Retrieval of diagnostic information cannot be
performed as part of an explicit transaction.</p>
<p>Diagnostic information can be retrieved at the level of the server (by querying
the <code class="docutils literal notranslate"><span class="pre">/</span></code> key) or for a specific data store (by querying the <code class="docutils literal notranslate"><span class="pre">/info</span></code> subkey
of the respective data store). In either case, the <code class="docutils literal notranslate"><span class="pre">component-info</span></code> request
parameter can be specified with values <code class="docutils literal notranslate"><span class="pre">short</span></code> or <code class="docutils literal notranslate"><span class="pre">extended</span></code> to determine
whether a shortened or an extended report should be returned. The result is
organized in a tree of hierarchical components. The component at the root of
this tree represents either the server or a data store (depending on which
component the information was requested for), and contains a number of
subcomponents that represent various parts of the root component. For example,
the information returned for a data store contains a subcomponent for each
tuple table, a subcomponent for each registered data source, and so on. The
information returned for the server contains the information for all of the
server’s data stores. The state of each component in the tree is described
using a list of property/value pairs, where values can be strings or numeric
values.</p>
<p>To output this complex data structure, the RESTful API converts the component
tree into a list as follows. Each component in the tree is assigned an integer
component ID using depth-first traversal (with root being assigned ID one).
Then, the tree is serialized as a result of a query containing three variables.
In each result to the query, variable <code class="docutils literal notranslate"><span class="pre">?ComponentID</span></code> contains the ID of the
component, variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> contains the name of the property describing
the component with the ID stored in <code class="docutils literal notranslate"><span class="pre">?ComponentID</span></code>, and variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code>
represents the property value. For each component, the result contains a row
with <code class="docutils literal notranslate"><span class="pre">?Property=&quot;Component</span> <span class="pre">name&quot;</span></code> and where <code class="docutils literal notranslate"><span class="pre">?Value</span></code> contains the name of
the component. Finally, for each component other than the root, the result
contains a row with <code class="docutils literal notranslate"><span class="pre">?Property=&quot;Parent</span> <span class="pre">component</span> <span class="pre">ID&quot;</span></code> and where <code class="docutils literal notranslate"><span class="pre">?Value</span></code>
contains the ID of the parent component.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/DataStore1/info?component-info=extended</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

ComponentID,Property,Value
1,Component name,RDFStore
1,Name,DataStore1
1,Unique ID,0123456789
1,Data store version,2
1,End resource ID,1000000
1,Persistent,no
1,Requires incremental reasoning,no
... etc ...
2,Component name,Data store parameters
2,Parent component ID,1
2,init-resource-capacity,16384
2,max-data-pool-size,10000000
2,max-resource-capacity,1000000
2,max-tuple-capacity,1000000
2,type,parallel-nn
... etc ...
</pre></div>
</div>
<p>In the above example, diagnostic information is requested for data store
<code class="docutils literal notranslate"><span class="pre">myStore</span></code>. The root result is component with ID <code class="docutils literal notranslate"><span class="pre">1</span></code> that represents the
data store. Properties such as <code class="docutils literal notranslate"><span class="pre">Name</span></code>, <code class="docutils literal notranslate"><span class="pre">Unique</span> <span class="pre">ID</span></code>, and so on provide
information about the data store. Component with ID <code class="docutils literal notranslate"><span class="pre">2</span></code> is a subcomponent of
the data store. It provides information about the data store parameters, such
as <code class="docutils literal notranslate"><span class="pre">init-resource-capacity</span></code>, <code class="docutils literal notranslate"><span class="pre">max-data-pool-size</span></code>, and so on.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ComponentInfo</span><span class="w"> </span><span class="n">componentInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">getComponentInfo</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">...</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="p">...</span>
<span class="n">ComponentInfo</span><span class="w"> </span><span class="n">componentInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getComponentInfo</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="invoking-data-store-operations">
<span id="rest-invoking-data-store-operations"></span><h3><span class="section-number">16.4.8. </span>Invoking Data Store Operations<a class="headerlink" href="#invoking-data-store-operations" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">POST</span></code> request on the <code class="docutils literal notranslate"><span class="pre">operations</span></code> key can be used to invoke an
operation on a data store. The query parameter <code class="docutils literal notranslate"><span class="pre">operation</span></code> should be set to
one of the operation values shown below.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">clear</span></code></p></td>
<td><p>Removes all facts, axioms, and/or rules from the
data store. Equivalent to the shell command <a class="reference internal" href="rdfox-shell.html#clear-command"><span class="std std-ref">clear</span></a>.
Query parameters <code class="docutils literal notranslate"><span class="pre">data-store-properties</span></code>, <code class="docutils literal notranslate"><span class="pre">prefixes</span></code>,
<code class="docutils literal notranslate"><span class="pre">facts</span></code>, <code class="docutils literal notranslate"><span class="pre">axioms</span></code>, <code class="docutils literal notranslate"><span class="pre">rules</span></code>, <code class="docutils literal notranslate"><span class="pre">commit-procedure</span></code> and
<code class="docutils literal notranslate"><span class="pre">delta-queries</span></code> determine what parts of the data store are to be
cleared.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">clear-rules-explicate-facts</span></code></p></td>
<td><p>Clears all rules and makes all facts explicit. Equivalent to the
shell command <a class="reference internal" href="rdfox-shell.html#clear-command"><span class="std std-ref">clear rules-explicate-facts</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">compact</span></code></p></td>
<td><p>Compacts all facts in the data store, reclaiming the space used
by the deleted facts in the process and persistent storage.
Please refer to <a class="reference internal" href="data-stores.html#compaction-dead-fact-removal"><span class="std std-numref">Section 5.2.4</span></a> for details.
Compaction cannot be performed as part of an explicit transaction.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">recompile</span></code></p></td>
<td><p>Recompiles the rules and commit procedure in the current data
store according to the current statistics. Equivalent to the
shell command <a class="reference internal" href="rdfox-shell.html#recompile-command"><span class="std std-ref">recompile</span></a>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">recompute-materialization</span></code></p></td>
<td><p>Performs a full, from-scratch materialization within the data
store. Equivalent to the shell command <a class="reference internal" href="rdfox-shell.html#remat-command"><span class="std std-ref">remat</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">update-materialization</span></code></p></td>
<td><p>Explicitly updates the set of materialized facts in the data
store. Unlike <code class="docutils literal notranslate"><span class="pre">recompute-materialization</span></code>, this option will use
incremental reasoning unless it is the first time reasoning has
run within the data store. Since materialization is updated
automatically when a transaction is committed, this command
should be used only inside transactions.
Equivalent to the shell command <a class="reference internal" href="rdfox-shell.html#mat-command"><span class="std std-ref">mat</span></a>.</p></td>
</tr>
</tbody>
</table>
<p>For example, clearing prefixes and facts can be achieved as follows.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/operations?operation=clear&amp;prefixes&amp;facts=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">clear</span><span class="p">(</span><span class="n">DataStorePart</span><span class="p">.</span><span class="na">PREFIXES</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DataStorePart</span><span class="p">.</span><span class="na">FACTS</span><span class="p">);</span>
</pre></div>
</div>
<p>As another example, clearing rules and explicating facts can be achieved as follows.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/operations?operation=clear-rules-explicate-facts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">clearRulesExplicateFacts</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-data-store-properties">
<span id="apis-managing-properties"></span><h2><span class="section-number">16.5. </span>Managing Data Store Properties<a class="headerlink" href="#managing-data-store-properties" title="Permalink to this headline">¶</a></h2>
<p>As explained in <a class="reference internal" href="servers.html#servers"><span class="std std-numref">Section 4</span></a>, each data store keeps track of a number of
data store properties that govern data store operation. The set of different
properties is fixed for each RDFox version, and the value of each property can
be managed as explained in this section.</p>
<div class="section" id="retrieving-data-store-properties">
<h3><span class="section-number">16.5.1. </span>Retrieving Data Store Properties<a class="headerlink" href="#retrieving-data-store-properties" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves all properties of a data store. The response is
written as an output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to
the name of each property and the variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the corresponding
property value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/properties</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
auto-update-statistics-mode,balanced
base-iri,https://rdfox.com/default-base-iri/
errors-in-bind,standard-compliant
invalid-literal-policy,error
max-backward-chaining-depth,unbounded
max-threads-used,all-available
property-paths-cardinality,standard-compliant
query-planning-algorithms,equality-optimization rewriting greedy-reordering sip-optimization
query-validation,strict
user-blank-node-import-policy,keep-unchanged
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dataStoreProperties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getDataStoreProperties</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">baseIRI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getDataStoreProperty</span><span class="p">(</span><span class="s">&quot;base-iri&quot;</span><span class="p">);</span>
<span class="p">...</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-data-store-properties">
<h3><span class="section-number">16.5.2. </span>Changing Data Store Properties<a class="headerlink" href="#changing-data-store-properties" title="Permalink to this headline">¶</a></h3>
<p>The following request changes properties of a data store. As shown, it is
possible to set several properties in a single request. The response is written
as an output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the
name of each property whose change was requested and the variable <code class="docutils literal notranslate"><span class="pre">?Change</span></code>
to a Boolean value indicating whether the value was actually changed (i.e., it
was different from the current property value).</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/properties?base-iri=http%3A%2F%2Fexample.com%2F&amp;max-threads-used=2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Changed
max-threads-used,true
base-iri,true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">setDataStoreProperty</span><span class="p">(</span><span class="s">&quot;base-iri&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://example.com/&quot;</span><span class="p">);</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">setDataStoreProperty</span><span class="p">(</span><span class="s">&quot;max-threads-used&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-data-store-prefixes">
<span id="apis-data-store-prefixes"></span><h2><span class="section-number">16.6. </span>Managing Data Store Prefixes<a class="headerlink" href="#managing-data-store-prefixes" title="Permalink to this headline">¶</a></h2>
<p>As explained in <a class="reference internal" href="servers.html#servers"><span class="std std-numref">Section 4</span></a>, each data store keeps track of a base IRI
and a set of prefixes, which provide the defaults for content import/export and
query evaluation operations. The base IRI is a data store property and is
managed as explained in <a class="reference internal" href="#apis-managing-properties"><span class="std std-numref">Section 16.5</span></a>. In contrast, data
store prefixes are managed as explained in this section.</p>
<div class="section" id="retrieving-prefixes">
<h3><span class="section-number">16.6.1. </span>Retrieving Prefixes<a class="headerlink" href="#retrieving-prefixes" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the prefixes of a data store. The response is
written as an output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?PrefixName</span></code>
to the prefix name and variable <code class="docutils literal notranslate"><span class="pre">?PrefixIRI</span></code> to the prefix IRI.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/prefixes</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

PrefixName,PrefixIRI
:,http://example.com/
owl:,http://www.w3.org/2002/07/owl#
rdf:,http://www.w3.org/1999/02/22-rdf-syntax-ns#
... etc ...
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Prefixes</span><span class="w"> </span><span class="n">prefixes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getPrefixes</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-prefixes-in-bulk">
<h3><span class="section-number">16.6.2. </span>Setting Prefixes in Bulk<a class="headerlink" href="#setting-prefixes-in-bulk" title="Permalink to this headline">¶</a></h3>
<p>The following request replaces the prefixes of the data store with the ones
specified in the request. The request content can be any of the formats
supported by RDFox that contains just the prefixes (and no facts, rules, or
axioms).</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/prefixes</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

@prefix p: &lt;http://new.prefix/&gt; .
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Prefixes</span><span class="w"> </span><span class="n">prefixes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">setPrefixes</span><span class="p">(</span><span class="n">prefixes</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-one-prefix">
<h3><span class="section-number">16.6.3. </span>Setting One Prefix<a class="headerlink" href="#setting-one-prefix" title="Permalink to this headline">¶</a></h3>
<p>One prefix of the data store can be set using a <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request with the
<code class="docutils literal notranslate"><span class="pre">operation=set</span></code> request parameter. The prefix name and prefix IRIs are
specified using the <code class="docutils literal notranslate"><span class="pre">prefix-name</span></code> and <code class="docutils literal notranslate"><span class="pre">prefix-iri</span></code> request parameters,
respectively. The response is written as an output of a SPARQL query that binds
the variable <code class="docutils literal notranslate"><span class="pre">?Changed</span></code> to the Boolean value reflecting whether the set of
data store prefixes was changed or not.</p>
<p>The following request sets the prefix name <code class="docutils literal notranslate"><span class="pre">pn:</span></code> to the prefix IRI
<code class="docutils literal notranslate"><span class="pre">http://example.com/</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/prefixes?operation=set&amp;prefix-name=pn:&amp;prefix-iri=http%3A%2F%2Fexample.com%2F</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Prefixes</span><span class="w"> </span><span class="n">prefixes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">setPrefix</span><span class="p">(</span><span class="s">&quot;pn:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://example.com/&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="unsetting-one-prefix">
<h3><span class="section-number">16.6.4. </span>Unsetting One Prefix<a class="headerlink" href="#unsetting-one-prefix" title="Permalink to this headline">¶</a></h3>
<p>One prefix of the data store can be unset using a <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request with the
<code class="docutils literal notranslate"><span class="pre">operation=unset</span></code> request parameter. The prefix name is specified using the
<code class="docutils literal notranslate"><span class="pre">prefix-name``request</span> <span class="pre">parameter.</span> <span class="pre">The</span> <span class="pre">response</span> <span class="pre">is</span> <span class="pre">written</span> <span class="pre">as</span> <span class="pre">an</span> <span class="pre">output</span> <span class="pre">of</span> <span class="pre">a</span>
<span class="pre">SPARQL</span> <span class="pre">query</span> <span class="pre">that</span> <span class="pre">binds</span> <span class="pre">the</span> <span class="pre">variable</span> <span class="pre">``?Changed</span></code> to the Boolean value
reflecting whether the set of data store prefixes was changed or not.</p>
<p>The following request unsets the prefix name <code class="docutils literal notranslate"><span class="pre">pn:</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/prefixes?operation=unset&amp;prefix-name=pn:</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Prefixes</span><span class="w"> </span><span class="n">prefixes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">unsetPrefix</span><span class="p">(</span><span class="s">&quot;pn:&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-delta-queries">
<span id="apis-data-store-delta-queries"></span><h2><span class="section-number">16.7. </span>Managing Delta Queries<a class="headerlink" href="#managing-delta-queries" title="Permalink to this headline">¶</a></h2>
<p>As explained in <a class="reference internal" href="servers.html#servers"><span class="std std-numref">Section 4</span></a>, each data store may have a number of delta
queries registered with it. Delta queries are used to capture changes to the
data store content. The following sections show how delta queries can be
managed programmatically.</p>
<div class="section" id="listing-delta-queries">
<h3><span class="section-number">16.7.1. </span>Listing Delta Queries<a class="headerlink" href="#listing-delta-queries" title="Permalink to this headline">¶</a></h3>
<p>The request below retrieves the list of delta queries registered with the data
store. The response is provided as an output of a SPARQL query that, for each
delta query, binds variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of the delta query, variable
<code class="docutils literal notranslate"><span class="pre">?UniqueID</span></code> to the delta query unique ID, <code class="docutils literal notranslate"><span class="pre">?Query</span></code> to the SPARQL query of
the delta query, <code class="docutils literal notranslate"><span class="pre">?FormatName</span></code> to the format of the delta query results,
<code class="docutils literal notranslate"><span class="pre">?SnapshotsMaxSize</span></code> to the maximum number of results in a snapshot,
<code class="docutils literal notranslate"><span class="pre">?DeletionsMaxSize</span></code> to the maximum number of results in a deletion,
<code class="docutils literal notranslate"><span class="pre">?AdditionsMaxSize</span></code> to the maximum number of results in an addition,
<code class="docutils literal notranslate"><span class="pre">?LastDataStoreVersionWithSnapshot</span></code> to the most recent data store version for
which a snapshot has been computed, <code class="docutils literal notranslate"><span class="pre">?LastDataStoreVersionWithDeletion</span></code> to
the most recent data store version which deleted one or more results, and
<code class="docutils literal notranslate"><span class="pre">?LastDataStoreVersionWithAddition</span></code> to the most recent data store version
which added one or more results.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/deltaqueries</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,UniqueID,Query,FormatName,SnapshotsMaxSize,DeletionsMaxSize,AdditionsMaxSize,LastDataStoreVersionWithSnapshot,LastDataStoreVersionWithDeletion,LastDataStoreVersionWithAddition
DeltaQuery1,18348114304957473860,SELECT * WHERE { ?s ?p ?o },text/csv,none,unlimited,1000,9,10,-1
DeltaQueryForS,16729953247409408432,SELECT * WHERE { ?s ?s ?s },text/csv,1001,none,none,-1,-1,-1
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">DeltaQueryInfo</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">deltaQueryInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">listDeltaQueries</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-delta-query-properties">
<h3><span class="section-number">16.7.2. </span>Listing Delta Query Properties<a class="headerlink" href="#listing-delta-query-properties" title="Permalink to this headline">¶</a></h3>
<p>The request below retrieves the properties of a single delta query that were
determined at delta query creation. The response is written as the output of
a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the property name,
and variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the property value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/deltaqueries/DeltaQuery1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,DeltaQuery1
unique-id,18348114304957473860
query,SELECT * WHERE { ?s ?p ?o }
format-name,text/csv
snapshots-max-size,none
deletions-max-size,unlimited
additions-max-size,1000
last-data-store-version-with-snapshot,9
last-data-store-version-with-deletion,10
last-data-store-version-with-addition,-1
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaQueryInfo</span><span class="w"> </span><span class="n">deltaQueryInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">describeDeltaQuery</span><span class="p">(</span><span class="s">&quot;DeltaQuery1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-a-delta-query">
<h3><span class="section-number">16.7.3. </span>Registering a Delta Query<a class="headerlink" href="#registering-a-delta-query" title="Permalink to this headline">¶</a></h3>
<p>The following request creates a new delta query. The delta query name is
specified as part of the request URL. The <code class="docutils literal notranslate"><span class="pre">query</span></code> must be provided, either as
a parameter in the request URL or in the request body (with the
<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header set to <code class="docutils literal notranslate"><span class="pre">application/sparql-query</span></code>). The
<code class="docutils literal notranslate"><span class="pre">format-name</span></code> must be provided as a URL parameter, and the
<code class="docutils literal notranslate"><span class="pre">snapshots-max-size</span></code>, <code class="docutils literal notranslate"><span class="pre">deletions-max-size</span></code> and <code class="docutils literal notranslate"><span class="pre">additions-max-size</span></code> delta
query parameters may be provided as URL parameters, otherwise taking the
default value of <code class="docutils literal notranslate"><span class="pre">unlimited</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/TestDataStore/deltaqueries/DeltaQueryName?format-name=text%2Fcsv&amp;deletions-max-size=none&amp;additions-max-size=1000</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

SELECT * WHERE { ?S ?P ?O }
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">registerDeltaQuery</span><span class="p">(</span><span class="s">&quot;DeltaQueryName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SELECT * WHERE { ?S ?P ?O }&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deregistering-a-delta-query">
<h3><span class="section-number">16.7.4. </span>Deregistering a Delta Query<a class="headerlink" href="#deregistering-a-delta-query" title="Permalink to this headline">¶</a></h3>
<p>The following request deregisters a delta query.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/deltaqueries/DeltaQueryName</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">deregisterDeltaQuery</span><span class="p">(</span><span class="s">&quot;DeltaQueryName&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-the-delta-query-evaluation-mode">
<h3><span class="section-number">16.7.5. </span>Setting the Delta Query Evaluation Mode<a class="headerlink" href="#setting-the-delta-query-evaluation-mode" title="Permalink to this headline">¶</a></h3>
<p>The following request sets the evaluation mode of a delta query to snapshot,
thus triggering the computation of a snapshot for the delta query.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/deltaqueries/DeltaQueryName?evaluation-mode=snapshot</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">setDeltaQueryEvaluationMode</span><span class="p">(</span><span class="s">&quot;DeltaQueryName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DeltaQueryEvaluationMode</span><span class="p">.</span><span class="na">SNAPSHOT</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-delta-query-answers">
<h3><span class="section-number">16.7.6. </span>Listing Delta Query Answers<a class="headerlink" href="#listing-delta-query-answers" title="Permalink to this headline">¶</a></h3>
<p>The request below retrieves the list of delta query answers. There are four
optional parameters: <code class="docutils literal notranslate"><span class="pre">delta-query-name</span></code>, <code class="docutils literal notranslate"><span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code>, and <code class="docutils literal notranslate"><span class="pre">type</span></code> which
can be used to restrict the results to only include delta query answers that
match the specified delta query name, data store version range, and delta query
answer type, respectively. The response is written as an output of a SPARQL
query that, for each answer to the delta query, binds variable
<code class="docutils literal notranslate"><span class="pre">?DeltaQueryName</span></code> to the name of the delta query, <code class="docutils literal notranslate"><span class="pre">?DataStoreVersion</span></code> to the
data store version at which the delta query was evaluated, <code class="docutils literal notranslate"><span class="pre">?AnswerType</span></code> to
either <code class="docutils literal notranslate"><span class="pre">snapshot</span></code>, <code class="docutils literal notranslate"><span class="pre">deletion</span></code> or <code class="docutils literal notranslate"><span class="pre">addition</span></code> depending on the type of
answer this is, <code class="docutils literal notranslate"><span class="pre">?Path</span></code> to the path of the delta query answer, and
<code class="docutils literal notranslate"><span class="pre">?FormatName</span></code> to the format of the delta query results.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/deltaqueryanswers?type=snapshot</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

DeltaQueryName,DataStoreVersion,AnswerType,Path,FormatName
DeltaQuery1,1,snapshot,17982538506969064140/delta-query-answers/00000000000000000001_18245535438306272199/00000000000000000001.snapshot.18245535438306272199,text/csv
DeltaQuery2,5,snapshot,17982538506969064140/delta-query-answers/00000000000000000002_18245535438306272199/00000000000000000005.snapshot.18245535438306272199,text/csv
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">listDeltaQueryAnswers</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">(),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">(),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">(),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">DeltaQueryAnswerType</span><span class="p">.</span><span class="na">SNAPSHOT</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-a-delta-query-answer">
<h3><span class="section-number">16.7.7. </span>Retrieving a Delta Query Answer<a class="headerlink" href="#retrieving-a-delta-query-answer" title="Permalink to this headline">¶</a></h3>
<p>The request below retrieves an individual delta query answer. The response is provided
in the format type specified at delta query creation.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/deltaqueryanswers/content?delta-query-name=DeltaQuery1&amp;type=snapshot&amp;version=1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

?s,?p,?o
&lt;http://example.com/s&gt;,&lt;http://example.com/p&gt;,&lt;http://example.com/o&gt;
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">exportDeltaQueryAnswer</span><span class="p">(</span><span class="n">outputStream</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DeltaQuery1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">DeltaQueryAnswerType</span><span class="p">.</span><span class="na">SNAPSHOT</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-delta-query-answers">
<h3><span class="section-number">16.7.8. </span>Deleting Delta Query Answers<a class="headerlink" href="#deleting-delta-query-answers" title="Permalink to this headline">¶</a></h3>
<p>The request shows how to delete delta query answers. There are four optional
parameters: <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code>, and <code class="docutils literal notranslate"><span class="pre">type</span></code> which can be used to
restrict the deletion to only include delta query answers that match the
specified delta query name, data store version range, and delta query answer
type, respectively. In the example below, we delete the snapshots of all
queries produced up to data store version 4.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/deltaqueryanswers?to=4&amp;type=snapshot</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

?NumberOfDeletions
1
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">deleteDeltaQueryAnswers</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">(),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">(),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">DeltaQueryAnswerType</span><span class="p">.</span><span class="na">SNAPSHOT</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-the-commit-procedure">
<span id="apis-data-store-commit-procedure"></span><h2><span class="section-number">16.8. </span>Managing the Commit Procedure<a class="headerlink" href="#managing-the-commit-procedure" title="Permalink to this headline">¶</a></h2>
<p>As explained in <a class="reference internal" href="servers.html#servers"><span class="std std-numref">Section 4</span></a>, each data store may have a SPARQL update
associated with it for the purposes of capturing additional explicit facts as
part of each transaction. The following sections show how a data store’s commit
procedure can be managed programatically.</p>
<div class="section" id="retrieving-the-commit-procedure">
<h3><span class="section-number">16.8.1. </span>Retrieving the Commit Procedure<a class="headerlink" href="#retrieving-the-commit-procedure" title="Permalink to this headline">¶</a></h3>
<p>The request below retrieves the commit procedure of the data store. If no
commit procedure is set on the data store, a <code class="docutils literal notranslate"><span class="pre">204</span></code> status code is returned,
otherwise the status code is <code class="docutils literal notranslate"><span class="pre">200</span></code> and the commit procedure is returned in
the body as shown below.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/commitprocedure</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/sparql-update; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">88</span>

INSERT { ?S :actionTakenAt ?now } WHERE { ?S rdf:type :NewAction . BIND(NOW() AS ?now) }
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="n">commitProcedure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getCommitProcedure</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-a-commit-procedure">
<h3><span class="section-number">16.8.2. </span>Setting a Commit Procedure<a class="headerlink" href="#setting-a-commit-procedure" title="Permalink to this headline">¶</a></h3>
<p>A data store’s commit procedure can be set using a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request with the
desired SPARQL update in the body, as shown below. The response is written as an
output of a SPARQL query that binds the variable <code class="docutils literal notranslate"><span class="pre">?Changed</span></code> to the Boolean
value reflecting whether the data store’s commit procedure was changed or not.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/commitprocedure</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/sparql-update</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">81</span>

INSERT { ?S :actionTakenAt ?now } WHERE { ?S a :NewAction . BIND(NOW() AS ?now) }
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

Changed
false
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">setCommitProcedure</span><span class="p">(</span><span class="s">&quot;INSERT { ?S :actionTakenAt ?now } WHERE { ?S a :NewAction . BIND(NOW() AS ?now) }&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-data-store-content">
<span id="apis-managing-content"></span><h2><span class="section-number">16.9. </span>Managing Data Store Content<a class="headerlink" href="#managing-data-store-content" title="Permalink to this headline">¶</a></h2>
<p>The facts, rules, and axioms are collectively called the <em>content</em> of the data
store, and they can be managed using <code class="docutils literal notranslate"><span class="pre">/content</span></code> key. All modification is
transactional — that is, a transaction is started before the call and it is
committed (if modification is successful) or rolled back (if there is an error)
before the call returns. All reasoning (if any is needed) is performed before
the transaction is committed.</p>
<p>The formats that RDFox supports for encoding triples and/or rules are described
in <a class="reference internal" href="import-and-export.html#data-store-content-formats"><span class="std std-numref">Section 8.1</span></a> and are identified using MIME types.
RDFox can usually detect the format of input data, so the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>
specification in update requests can generally be omitted. However, if the
<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header is present, it must match the type of the content or
the update is rejected.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/content</span></code> key essentially provides two ways to manage data store
content, which are selected as specified below.</p>
<ul class="simple">
<li><p>If exactly one <code class="docutils literal notranslate"><span class="pre">default</span></code> or <code class="docutils literal notranslate"><span class="pre">graph</span></code> query parameter is present, then the
<code class="docutils literal notranslate"><span class="pre">/content</span></code> key follows the <a class="reference external" href="http://www.w3.org/TR/sparql11-http-rdf-update/">SPARQL 1.1 Graph Store HTTP Protocol</a> and provides
functionality for managing triples in either the default graph or in exactly
one named graph. The use of this protocol is described in more detail in
<a class="reference internal" href="#sparql-graph-protocol"><span class="std std-numref">Section 16.9.1</span></a>.</p></li>
<li><p>If neither <code class="docutils literal notranslate"><span class="pre">default</span></code> not <code class="docutils literal notranslate"><span class="pre">graph</span></code> query parameters are present, then the
<code class="docutils literal notranslate"><span class="pre">/content</span></code> key follows the <em>RDFox Update Protocol</em>. This protocol can
manage all parts of the data store content (i.e., facts, axioms, and/or
rules), as well as import data into several named graphs in one request. The
RDFox protocol is described in more detail in
<a class="reference internal" href="#rdfox-update-protocol"><span class="std std-numref">Section 16.9.2</span></a>.</p></li>
</ul>
<div class="section" id="using-the-sparql-1-1-graph-store-http-protocol">
<span id="sparql-graph-protocol"></span><h3><span class="section-number">16.9.1. </span>Using the SPARQL 1.1 Graph Store HTTP Protocol<a class="headerlink" href="#using-the-sparql-1-1-graph-store-http-protocol" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://www.w3.org/TR/sparql11-http-rdf-update/">SPARQL 1.1 Graph Store HTTP Protocol</a> protocol provides means for
the management of a single RDF graph. The <code class="docutils literal notranslate"><span class="pre">/content</span></code> key uses this protocol
whenever exactly one <code class="docutils literal notranslate"><span class="pre">default</span></code> or <code class="docutils literal notranslate"><span class="pre">graph</span></code> request parameter is specified.
The <code class="docutils literal notranslate"><span class="pre">default</span></code> request parameter specifies that the request is to operate on
the default graph; moreover, the value of the <code class="docutils literal notranslate"><span class="pre">graph</span></code> request parameter
specifies the IRI of a named graph that is subject to a graph update.</p>
<p>Since the SPARQL 1.1 Graph Store HTTP Protocol operates on a single graph, all
content submitted to the <code class="docutils literal notranslate"><span class="pre">/content</span></code> key must encode a set of triples that are
used to update the specified graph; thus, the content is allowed to follow
<code class="docutils literal notranslate"><span class="pre">text/turtle</span></code>, <code class="docutils literal notranslate"><span class="pre">application/n-triples</span></code>, and <code class="docutils literal notranslate"><span class="pre">text/x.gen-turtle</span></code> MIME
types. Consequently, this protocol cannot update several graphs at once using
the TriG format, and it cannot be used to manage rules and axioms. This is in
contrast to the RDF protocol (see <a class="reference internal" href="#rdfox-update-protocol"><span class="std std-numref">Section 16.9.2</span></a>), which can
provide more flexibility. RDFox does not implement the <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> verb of the
SPARQL 1.1 Graph Store HTTP Protocol because the standard does not specify
exactly the semantics of such operations. Finally, the Java API does not
support the operations of the Graph Store HTTP Protocol directly; however, all
operations can be easily implemented by means of other operations described
elsewhere in this document.</p>
<div class="section" id="retrieving-a-graph">
<h4><span class="section-number">16.9.1.1. </span>Retrieving a Graph<a class="headerlink" href="#retrieving-a-graph" title="Permalink to this headline">¶</a></h4>
<p>The following request retrieves the content of the default graph. Such a
request supports the same parameters as the corresponding request of the RDFox
protocol; please refer to <a class="reference internal" href="#rdfox-update-protocol-get"><span class="std std-numref">Section 16.9.2.1</span></a> for more
information.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/content?default</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/turtle; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Triples of the default graph serialized according to the Turtle 1.1 specification]
</pre></div>
</div>
</div>
<div class="section" id="adding-triples-to-a-graph">
<h4><span class="section-number">16.9.1.2. </span>Adding Triples to a Graph<a class="headerlink" href="#adding-triples-to-a-graph" title="Permalink to this headline">¶</a></h4>
<p>The following request adds triples incrementally to a named graph
<code class="docutils literal notranslate"><span class="pre">http://example.com/</span></code>.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content?graph=http%3A%2F%2Fexample.com%2F</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Triples serialized according to the Turtle 1.1 specification]
</pre></div>
</div>
</div>
<div class="section" id="replacing-a-graph">
<h4><span class="section-number">16.9.1.3. </span>Replacing a Graph<a class="headerlink" href="#replacing-a-graph" title="Permalink to this headline">¶</a></h4>
<p>The following request replaces all triples in a named graph
<code class="docutils literal notranslate"><span class="pre">http://example.com/</span></code> with the triples specified in the request body.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/content?graph=http%3A%2F%2Fexample.com%2F</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Triples serialized according to the Turtle 1.1 specification]
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-graph">
<h4><span class="section-number">16.9.1.4. </span>Deleting a Graph<a class="headerlink" href="#deleting-a-graph" title="Permalink to this headline">¶</a></h4>
<p>The following request deletes all triples in a named graph
<code class="docutils literal notranslate"><span class="pre">http://example.com/</span></code>.</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/content?graph=http%3A%2F%2Fexample.com%2F</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>Note that RDFox does not maintain named graphs as distinct entities, and so the
notion of whether a data store contains a named graph or not is ill-defined;
consequently, RDFox will never return <code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code> error code for this
request. This is consistent with the evaluation of a <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">...</span> <span class="pre">WHERE</span> <span class="pre">...</span></code>
statement, which achieves the same effect.</p>
</div>
</div>
<div class="section" id="rdfox-update-protocol">
<span id="id2"></span><h3><span class="section-number">16.9.2. </span>RDFox Update Protocol<a class="headerlink" href="#rdfox-update-protocol" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">/content</span></code> key implements the RDFox Update Protocol when neither
<code class="docutils literal notranslate"><span class="pre">default</span></code> nor <code class="docutils literal notranslate"><span class="pre">graph</span></code> request parameters are present.</p>
<div class="section" id="retrieving-data-store-content">
<span id="rdfox-update-protocol-get"></span><h4><span class="section-number">16.9.2.1. </span>Retrieving Data Store Content<a class="headerlink" href="#retrieving-data-store-content" title="Permalink to this headline">¶</a></h4>
<p>The following request retrieves the content of the data store. The media type
specified using the <code class="docutils literal notranslate"><span class="pre">Accept</span></code> header determines which subset of the store is
retrieved. For example, a request to output data store content using the Turtle
format (MIME type <code class="docutils literal notranslate"><span class="pre">text/turtle</span></code>) retrieves all triples from the default
graph, whereas a request to output the content using the Datalog format (MIME
type <code class="docutils literal notranslate"><span class="pre">application/x.datalog</span></code>) retrieves all rules and no triples. Parameters
that customize the export operation can be specified in the query string of the
request URI.</p>
<p>When retrieving facts in the <code class="docutils literal notranslate"><span class="pre">application/n-triples</span></code>, <code class="docutils literal notranslate"><span class="pre">text/turtle</span></code>,
<code class="docutils literal notranslate"><span class="pre">application/n-quads</span></code>, or <code class="docutils literal notranslate"><span class="pre">application/trig</span></code> formats, the only supported
parameter is <code class="docutils literal notranslate"><span class="pre">fact-domain</span></code>, and its value is the fact domain
(<a class="reference internal" href="tuple-tables.html#fact-domains"><span class="std std-numref">6.2</span></a>) that determines which facts are exported.
The default fact domain is <code class="docutils literal notranslate"><span class="pre">explicit</span></code>.</p>
<p>When retrieving rules in the <code class="docutils literal notranslate"><span class="pre">application/x.datalog</span></code> format, the supported
parameters are <code class="docutils literal notranslate"><span class="pre">rule-domain</span></code>, whose value identifies the rule domain
(<a class="reference internal" href="servers.html#rules"><span class="std std-numref">4.1.4</span></a>) being exported, and <code class="docutils literal notranslate"><span class="pre">fact-domain</span></code>, whose value
identifies the domain for facts in tuple tables other than <code class="docutils literal notranslate"><span class="pre">DefaultTriples</span></code>
and <code class="docutils literal notranslate"><span class="pre">Quads</span></code> that are to be exported. If the <code class="docutils literal notranslate"><span class="pre">fact-domain</span></code> parameter is
absent, no facts are exported (i.e., only rules are exported). The default
value of <code class="docutils literal notranslate"><span class="pre">rule-domain</span></code> is <code class="docutils literal notranslate"><span class="pre">user</span></code>; moreover, the <code class="docutils literal notranslate"><span class="pre">fact-domain</span></code> parameter
is absent by default.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/content?fact-domain=all</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/turtle; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[The content of the store formatted according to the Turtle 1.1 standard]
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">exportData</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/turtle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="incrementally-adding-data-store-content">
<span id="apis-adding-data"></span><h4><span class="section-number">16.9.2.2. </span>Incrementally Adding Data Store Content<a class="headerlink" href="#incrementally-adding-data-store-content" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request can be used to incrementally add content to a data store.
The query parameter <code class="docutils literal notranslate"><span class="pre">operation</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">add-content</span></code>. The type of
content added is determined in the following way:</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header is absent, then the type of content is
inferred automatically from the supplied content.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header is present, then the supplied request body
must be of that type, or the request is rejected.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header has value <code class="docutils literal notranslate"><span class="pre">text/uri-list</span></code>, then the body of
the request is interpreted as a newline-delimited list of IRIs specifying the
location of the content to be added. RDFox will add the content by
dereferencing the listed IRIs. At least one IRI must be present; moreover, if
more than one IRI is specified, all IRIs are imported in parallel. If the
proprietary header <code class="docutils literal notranslate"><span class="pre">Imported-Content-Type</span></code> is present, then the content of
all IRIs in the list must be of that type, or the request is rejected.
Otherwise, the type for each IRI will be inferred automatically.</p></li>
</ul>
<p>Query parameter <code class="docutils literal notranslate"><span class="pre">default-graph</span></code> can be used to specify the name of the
default graph. That is, if this parameter is specified, then triples that would
normally be imported into the default graph will instead be imported into the
graph with the specified name. See also the description of the target default
graph parameter for import operations in <a class="reference internal" href="import-and-export.html#import-parameters"><span class="std std-numref">Section 8.2.1</span></a>.</p>
<p>RDFox will provide information about this operation as follows.</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">Accept</span></code> header identifies a SPARQL answer format, then the response
body is structured as an answer to a SPARQL query with variables <code class="docutils literal notranslate"><span class="pre">?Type</span></code>,
<code class="docutils literal notranslate"><span class="pre">?Line</span></code>, <code class="docutils literal notranslate"><span class="pre">?Column</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code>. For each error or
warning, an answer is emitted where the value of <code class="docutils literal notranslate"><span class="pre">?Type</span></code> identifies the
notification type (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;error&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;warning&quot;</span></code>, but other notification
types are possible too), the values of <code class="docutils literal notranslate"><span class="pre">?Line</span></code> and <code class="docutils literal notranslate"><span class="pre">?Column</span></code> may identify
the place in the input where the error was detected, and the value of
<code class="docutils literal notranslate"><span class="pre">?Description</span></code> describes the error or warning. Moreover, the following
answers will summarize information about the importation:</p>
<ul>
<li><p>For each prefix definition encountered during importation, one answer will
be emitted where the value of <code class="docutils literal notranslate"><span class="pre">?Type</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;prefix&quot;</span></code>, the value of
<code class="docutils literal notranslate"><span class="pre">?Description</span></code> is the prefix name (which ends with <code class="docutils literal notranslate"><span class="pre">:</span></code>), and <code class="docutils literal notranslate"><span class="pre">the</span>
<span class="pre">value</span> <span class="pre">of</span> <span class="pre">?Value</span></code> is the prefix URI. This allows the client to retrieve the
prefixes from the submitted input.</p></li>
<li><p>An answer with <code class="docutils literal notranslate"><span class="pre">?Type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;information&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">&quot;#aborted&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code> a Boolean value specifies whether the
import was aborted prematurely.</p></li>
<li><p>Answers with <code class="docutils literal notranslate"><span class="pre">?Type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;information&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">&quot;#errors&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;#warnings&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code> integers specify the
number of errors and warnings, respectively, encountered during import.</p></li>
<li><p>Answers with <code class="docutils literal notranslate"><span class="pre">?Type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;information&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">&quot;#processed-facts&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;#changed-facts&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code> integers
specify the number of facts processed in the input and facts actually added
to or deleted from the data store, respectively.</p></li>
<li><p>Answers with <code class="docutils literal notranslate"><span class="pre">?Type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;information&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">&quot;#processed-rules&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;#changed-rules&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code> integers
specify the number of rules processed in the input and rules actually added
to or deleted from the data store, respectively.</p></li>
<li><p>Answers with <code class="docutils literal notranslate"><span class="pre">?Type</span></code> equal to <code class="docutils literal notranslate"><span class="pre">&quot;information&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?Description</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">&quot;#processed-axioms&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;#changed-axioms&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?Value</span></code>
integers specify the number of axioms processed in the input and axioms
actually added to or deleted from the data store, respectively.</p></li>
</ul>
</li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">Accept</span></code> header is either absent or has value <code class="docutils literal notranslate"><span class="pre">text/plain</span></code>, then
the <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header of the response is then set to <code class="docutils literal notranslate"><span class="pre">text/plain</span></code>,
and the response body contains a human-readable description of the same
information as in the previous case.</p></li>
</ul>
<p>RDFox also uses a proprietary header <code class="docutils literal notranslate"><span class="pre">Notify-Immediately</span></code> to determine how to
return information about the operation to the client, which also determines the
status codes used.</p>
<ul class="simple">
<li><p>If the request does not include the <code class="docutils literal notranslate"><span class="pre">Notify-Immediately</span></code> header, then the
entire request is processed before the response is returned to the client.
The response will indicate success or failure by using one of the following
status codes (which are compatible with the <a class="reference external" href="http://www.w3.org/TR/sparql11-http-rdf-update/">SPARQL 1.1 Graph Store HTTP
Protocol</a>):</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code> indicates that at least one error has been
encountered,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code> indicates that no additional information is provided
so the response body is empty, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> indicates that no errors have been encountered, but the
response body contains additional information (which can be information
about warnings, or summary information in the extended format).</p></li>
</ul>
</li>
<li><p>If the request includes the <code class="docutils literal notranslate"><span class="pre">Notify-Immediately:</span> <span class="pre">true</span></code> header, then
notifications about errors and warnings are sent to the client as soon as
they are available, possibly even before the client has finished sending the
request body, thus allowing the client to take appropriate action early on.
For example, a client may decide to stop sending the rest of the request
body after receiving an error. This option increases the flexibility of the
RESTful API, but at the expense of added complexity.</p>
<ul>
<li><p>The client must keep reading the notifications while it is still sending
the request body. In particular, the notification produced and sent
eagerly by RDFox can fill the TCP/IP buffers on the sender and receiver
side, in which case RDFox will wait for client to read the notifications
and thus free the buffers. But then, if the client is not reading the
notifications, a deadlock will occur where the client is waiting for
RDFox to process the request content, and RDFox is waiting for the client
to read the notifications.</p></li>
<li><p>If a warning is generated before an error, RDFox must start producing
the response without knowing whether the entire operation will succeed
(i.e., errors can be generated later during the process). In such
situations, RDFox uses the <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code> status code in the response
to indicate that the status of the operation is not yet know. In such
situations, the operation succeeds if and only if the response body
contains no errors.</p></li>
</ul>
</li>
</ul>
<p>The following is an example of a successful request to incrementally add data
store content.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/content?operation=add-content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[The facts/rules to be added in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

prefix: pref: = http://www.test.com/test#
information: #aborted = false
information: #errors = 0
information: #warnings = 0
information: #processed-facts = 9
information: #changed-facts = 8
information: #processed-rules = 0
information: #changed-rules = 0
information: #processed-axioms = 0
information: #changed-axioms = 0
</pre></div>
</div>
<p>The following is an example of an unsuccessful request where errors are
returned in text format.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/content?operation=add-content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

a b c .
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

XX
error: line 1: column 3: Resource expected.
information: #aborted = false
information: #errors = 1
information: #warnings = 0
information: #processed-facts = 0
information: #changed-facts = 0
information: #processed-rules = 0
information: #changed-rules = 0
information: #processed-axioms = 0
information: #changed-axioms = 0

0
</pre></div>
</div>
<p>The following is an example of a request where errors are returned in a SPARQL
answer format.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/content?operation=add-content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv</span>

@prefix pref: &lt;http://www.test.com/test#&gt; .
pref:a pref:b pref:c .
a b c .
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

XX
Type,Line,Column,Description,Value
error,3,3,Resource expected.,
prefix,,,pref:,http://www.test.com/test#
information,,,#aborted,false
information,,,#errors,1
information,,,#warnings,0
information,,,#processed-facts,1
information,,,#changed-facts,1
information,,,#processed-rules,0
information,,,#changed-rules,0
information,,,#processed-axioms,0
information,,,#changed-axioms,0

0
</pre></div>
</div>
<p>In the Java API, notifications are received by passing an instance implementing
the <code class="docutils literal notranslate"><span class="pre">ImportNotificationMonitor</span></code> interface.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">ImportNotificationMonitor</span><span class="w"> </span><span class="n">importNotificationMonitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">ImportResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">importData</span><span class="p">(</span><span class="n">UpdateType</span><span class="p">.</span><span class="na">ADD</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">importNotificationMonitor</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-content-and-updating-prefixes">
<h4><span class="section-number">16.9.2.3. </span>Adding Content and Updating Prefixes<a class="headerlink" href="#adding-content-and-updating-prefixes" title="Permalink to this headline">¶</a></h4>
<p>When incrementally adding content to a data store, it is possible to instruct
RDFox to set the data store prefixes to the final set of prefixes after import.
The request for doing so is the same as in <a class="reference internal" href="#apis-adding-data"><span class="std std-numref">Section 16.9.2.2</span></a>, with the
difference that the <code class="docutils literal notranslate"><span class="pre">operation</span></code> request parameter needs to be set to
<code class="docutils literal notranslate"><span class="pre">add-content-update-prefixes</span></code>. This can be useful because the prefixes
included in the content then do not need to be explicitly provided in further
API calls to RDFox. In the Java API, this option is specified using the
<code class="docutils literal notranslate"><span class="pre">ADDITION_UPDATE_PREFIXES</span></code> update type.</p>
</div>
<div class="section" id="incrementally-deleting-data-store-content">
<h4><span class="section-number">16.9.2.4. </span>Incrementally Deleting Data Store Content<a class="headerlink" href="#incrementally-deleting-data-store-content" title="Permalink to this headline">¶</a></h4>
<p>The following request incrementally deletes content from a data store. The
request and response formats follow the same structure as in the case of
incremental addition however the <code class="docutils literal notranslate"><span class="pre">operation</span></code> query parameter should be set to
<code class="docutils literal notranslate"><span class="pre">delete-content</span></code>. Query parameter <code class="docutils literal notranslate"><span class="pre">default-graph</span></code> can be used to
specify the name of the default graph in the same way as in incremental
addition.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/content?operation=delete-content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[The facts/rules to be deleted in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

prefix: pref: = http://www.test.com/test#
information: #aborted = false
information: #errors = 0
information: #warnings = 0
information: #processed-facts = 9
information: #changed-facts = 9
information: #processed-rules = 0
information: #changed-rules = 0
information: #processed-axioms = 0
information: #changed-axioms = 0
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">ImportNotificationMonitor</span><span class="w"> </span><span class="n">importNotificationMonitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">ImportResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">importData</span><span class="p">(</span><span class="n">UpdateType</span><span class="p">.</span><span class="na">DELETE</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">importNotificationMonitor</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-all-data-store-content">
<h4><span class="section-number">16.9.2.5. </span>Deleting All Data Store Content<a class="headerlink" href="#deleting-all-data-store-content" title="Permalink to this headline">¶</a></h4>
<p>Parts of a data store can be deleted in one request using a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request.
Such a request must contain at least one of the <code class="docutils literal notranslate"><span class="pre">facts</span></code>, <code class="docutils literal notranslate"><span class="pre">axioms</span></code>, or
<code class="docutils literal notranslate"><span class="pre">rules</span></code> request parameters, which specify which parts of the data store
should be cleared. Such an operation is equivalent to a <code class="docutils literal notranslate"><span class="pre">clear</span></code> operation on
the data store.</p>
<p>The following request clears all facts and axioms in the data store.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/content?facts=true&amp;axioms</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">clear</span><span class="p">(</span><span class="n">DataStorePart</span><span class="p">.</span><span class="na">FACTS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DataStorePart</span><span class="p">.</span><span class="na">AXIOMS</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="replacing-all-data-store-content">
<span id="rdfox-update-protocol-put"></span><h4><span class="section-number">16.9.2.6. </span>Replacing All Data Store Content<a class="headerlink" href="#replacing-all-data-store-content" title="Permalink to this headline">¶</a></h4>
<p>Parts of a data store can be replaced in one request using a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request.
Such a request must contain at least one of the <code class="docutils literal notranslate"><span class="pre">facts</span></code>, <code class="docutils literal notranslate"><span class="pre">axioms</span></code>, or
<code class="docutils literal notranslate"><span class="pre">rules</span></code> request parameters. A <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request is equivalent to a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>
request with the same request parameters followed by an importation of the
specified content. Query parameter <code class="docutils literal notranslate"><span class="pre">default-graph</span></code> can be used to specify the
name of the default graph in the same way as in incremental addition. Depending
on a specific combination of parameters, such a request can be more efficient
than an incremental deletion of existing content and incremental addition of
new content.</p>
<p>The following request replaces the rules in the data store with the rules
specified in the request body.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/content?rules</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[The rules in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>The Java API does not have a separate ‘replace content’ primitive.</p>
</div>
<div class="section" id="adding-deleting-owl-axioms-from-triples">
<h4><span class="section-number">16.9.2.7. </span>Adding/Deleting OWL Axioms From Triples<a class="headerlink" href="#adding-deleting-owl-axioms-from-triples" title="Permalink to this headline">¶</a></h4>
<p>As explained in <a class="reference internal" href="reasoning.html#owl-support"><span class="std std-numref">Section 10.6</span></a>, RDFox can be instructed to analyze the
triples of one named graph, parse them into a set of OWL axioms, and add these
axioms to another named graph. An analogous operation can be used to remove the
axioms from a named graph. The named graph being analyzed and the named graph
to which the axioms are added may, but need not be the same.</p>
<p>In the RESTful API, the operation is invoked using the <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> verb. The
source and destination graphs are specified using the <code class="docutils literal notranslate"><span class="pre">source-graph</span></code> and
<code class="docutils literal notranslate"><span class="pre">destination-graph</span></code> query parameters, respectively. If either of the two
parameters is omitted, the default graph is used as a default. The
<code class="docutils literal notranslate"><span class="pre">operation</span></code> query parameter can be set to <code class="docutils literal notranslate"><span class="pre">add-axioms</span></code> or
<code class="docutils literal notranslate"><span class="pre">delete-axioms</span></code>. Finally, the <code class="docutils literal notranslate"><span class="pre">assertions</span></code> query parameter can be set to
<code class="docutils literal notranslate"><span class="pre">true</span></code>, in which case ABox assertions are extracted as well, or to <code class="docutils literal notranslate"><span class="pre">false</span></code>,
in which case only the TBox (i.e., schema) axioms are extracted. For example,
the following request imports the axioms from triples in named graph called
<code class="docutils literal notranslate"><span class="pre">SG</span></code> and stores the axioms into the named graph called <code class="docutils literal notranslate"><span class="pre">DG</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/content?operation=add-axioms&amp;source-graph=SG&amp;destination-graph=DG</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

XX
information,,,#processed-axioms,2
information,,,#changed-axioms,2

0
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">importAxiomsFromTriples</span><span class="p">(</span><span class="s">&quot;SG&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DG&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UpdateType</span><span class="p">.</span><span class="na">ADDITION</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="managing-data-sources">
<span id="apis-data-sources"></span><h2><span class="section-number">16.10. </span>Managing Data Sources<a class="headerlink" href="#managing-data-sources" title="Permalink to this headline">¶</a></h2>
<p>RDFox can access external data stored in different kinds of data sources.
Currently, a data source can be a CSV/TSV file, a PostgreSQL database, ODBC
database, or an Apache Solr index. For an overview of how RDFox manages data
sources, see <a class="reference internal" href="data-sources.html#data-sources"><span class="std std-numref">Section 7</span></a>.</p>
<p>All modification functions described in this sections are not transactional:
they are applied immediately, and in fact their invocation fails if the
connection has an active transaction. Consequently, there is no way to rollback
the effects of these functions.</p>
<div class="section" id="listing-the-registered-data-sources">
<h3><span class="section-number">16.10.1. </span>Listing the Registered Data Sources<a class="headerlink" href="#listing-the-registered-data-sources" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of data sources registered with a data
store. The response is written as an output of a SPARQL query that, for each data
source, binds variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of the data source. Variables <code class="docutils literal notranslate"><span class="pre">?Type</span></code>
, <code class="docutils literal notranslate"><span class="pre">?Parameters</span></code>, and <code class="docutils literal notranslate"><span class="pre">?NumberOfTables</span></code> are also returned. However, these variables
are optional, and are bound only if the user has read privilege over the data source
in question (otherwise returning <code class="docutils literal notranslate"><span class="pre">UNDEF</span></code>). If the user does have the
necessary privileges, the <code class="docutils literal notranslate"><span class="pre">?Type</span></code> variable is bound to the data source type,
variable <code class="docutils literal notranslate"><span class="pre">?Parameters</span></code> to a string describing the data source parameters
(with all key-value pairs concatenated as in a query string), and variable
<code class="docutils literal notranslate"><span class="pre">?NumberOfTables</span></code> to the number of tables in the data source.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/datasources</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,Type,Parameters,NumberOfTables
F1,PostgreSQL,connection-string=postgresql://user:pw@localhost:5432/DB,2
DBpedia,DelimitedFile,&quot;file=/table.csv&amp;delimiter=,&quot;,1
anotherDB,,,
[...]
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">DataSourceInfo</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">dataSourceInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">listDataSources</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-information-about-a-data-source">
<h3><span class="section-number">16.10.2. </span>Retrieving Information About a Data Source<a class="headerlink" href="#retrieving-information-about-a-data-source" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves information about a data source. The response
is written as an output of a SPARQL query that binds variables <code class="docutils literal notranslate"><span class="pre">?Property</span></code>
and <code class="docutils literal notranslate"><span class="pre">?Value</span></code>. What exact properties and values are supported depends on the
data source. The names of all parameters specified at the time the tuple table
was created are prefixed with <code class="docutils literal notranslate"><span class="pre">parameters.</span></code></p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/datasources/mySource</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,mySource
type,PostgreSQL
tables,3
... etc ...
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DataSourceInfo</span></code> class encapsulates information about a data source in
the Java API. Instances of this class are immutable.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataSourceInfo</span><span class="w"> </span><span class="n">dataSourceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">describeDataSource</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-a-data-source">
<h3><span class="section-number">16.10.3. </span>Registering a Data Source<a class="headerlink" href="#registering-a-data-source" title="Permalink to this headline">¶</a></h3>
<p>The following request registers a new data source. The data source name and any
optional data source parameters are encoded in the URI. Data source registration
cannot be performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/datasources/mySource?type=PostgreSQL&amp;key1=val1&amp;key2=val2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/datasources/mySource</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val1&quot;</span><span class="p">);</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val2&quot;</span><span class="p">);</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">registerDataSource</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PostgreSQL&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deregistering-a-data-source">
<h3><span class="section-number">16.10.4. </span>Deregistering a Data Source<a class="headerlink" href="#deregistering-a-data-source" title="Permalink to this headline">¶</a></h3>
<p>The following request deregisters a data source. The request succeeds if no
tuple tables are mounted on the data source. Thus, to delete a data source, one
must first delete all rules mentioning any tuple tables of the data source, and
then delete all tuple tables mounted from the data source. Data source
deregistration cannot be performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/datasources/mySource</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">deregisterDataSource</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-the-data-source-tables-of-a-data-source">
<h3><span class="section-number">16.10.5. </span>Listing the Data Source Tables of a Data Source<a class="headerlink" href="#listing-the-data-source-tables-of-a-data-source" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of data source tables of a data
source. The response is written as an output of a SPARQL query that binds
variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of a data source table, variable
<code class="docutils literal notranslate"><span class="pre">?NumberOfColumns</span></code> to the number of columns in the table, and variable
<code class="docutils literal notranslate"><span class="pre">?Columns</span></code> to a percent-encoded string describing the table columns using the
form <code class="docutils literal notranslate"><span class="pre">name1=dt1&amp;name2=dt2&amp;...</span></code> where <code class="docutils literal notranslate"><span class="pre">namei</span></code> is the column name, and
<code class="docutils literal notranslate"><span class="pre">dti</span></code> is the column datatype.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/datasources/mySource/tables</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,NumberOfColumns,Columns
drivers,2,id=integer&amp;name=string
constructors,3,key=integer&amp;name=string&amp;address=string
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">DataSourceTableInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dataSourceTableInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">listDataSourceTables</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-information-about-a-data-source-table">
<h3><span class="section-number">16.10.6. </span>Retrieving Information About a Data Source Table<a class="headerlink" href="#retrieving-information-about-a-data-source-table" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves information about a data source table. The
response is written as an output of a SPARQL query that binds variable
<code class="docutils literal notranslate"><span class="pre">?Column</span></code> to the integer referencing a column of a data source, variable
<code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the column name, and variable <code class="docutils literal notranslate"><span class="pre">?Datatype</span></code> to the name of the
RDFox datatype that best corresponds to the datatype of the the column in the
data source.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/datasources/mySource/tables/drivers</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Column,Name,Datatype
1,id,http://www.w3.org/2001/XMLSchema#name
2,first_name,http://www.w3.org/2001/XMLSchema#string
3,last_name,http://www.w3.org/2001/XMLSchema#string
... etc ...
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DataSourceTableInfo</span></code> class encapsulates information about a data source
table in the Java API. Instances of this class are immutable.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataSourceTableInfo</span><span class="w"> </span><span class="n">dataSourceTableInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">describeDataSourceTable</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;drivers&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="sampling-a-data-source-table">
<h3><span class="section-number">16.10.7. </span>Sampling a Data Source Table<a class="headerlink" href="#sampling-a-data-source-table" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves a sample of data from a data source table. The
response is written as an output of a SPARQL query that binds the variable
corresponding to column names to the values in the columns. The <code class="docutils literal notranslate"><span class="pre">limit=n</span></code>
request parameter would determine how many rows are to be returned. RDFox
supports a configurable, system-wide maximum limit on the number of returned
rows, which can be used to avoid accidentally requesting large portions of a
data source. The main purpose of this API is not to provide access to the data,
but only provide a sample of the data so that clients can see roughly what the
source contains and then mount the corresponding tuple table.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/datasources/mySource/tables/drivers/data?limit=20</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

id,first_name,last_name
1,Ayrton,Senna
2,Michael,Schumacher
... etc ...
</pre></div>
</div>
<p>Data from data source tables is returned using cursors in the Java API. These
cursors are always full — that is, all relevant data is retrieved before the
call finishes. The result is unaffected by the transaction that may be
associated with the connection: RDFox does not support transactions over data
sources.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Cursor</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getDataSourceTableData</span><span class="p">(</span><span class="s">&quot;mySource&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;drivers&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-tuple-tables">
<span id="apis-tuple-tables"></span><h2><span class="section-number">16.11. </span>Managing Tuple Tables<a class="headerlink" href="#managing-tuple-tables" title="Permalink to this headline">¶</a></h2>
<p>Both types of tuple tables are managed using the same API, which is described
in this section. All modification functions described in this sections are not
transactional: they are applied immediately, and in fact their invocation fails
if the connection has an active transaction. Consequently, there is no way to
rollback the effects of these functions.</p>
<div class="section" id="listing-the-available-tuple-tables">
<h3><span class="section-number">16.11.1. </span>Listing the Available Tuple Tables<a class="headerlink" href="#listing-the-available-tuple-tables" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of tuple tables currently available in
a data store. The response is written as an output of a SPARQL query that, for each
tuple table, binds variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of the tuple table. Variables <code class="docutils literal notranslate"><span class="pre">?Type</span></code>
, <code class="docutils literal notranslate"><span class="pre">?ID</span></code>, <code class="docutils literal notranslate"><span class="pre">?MinArity</span></code>, and <code class="docutils literal notranslate"><span class="pre">?MaxArity</span></code> are also returned. However, these variables
are optional, and are bound only if the user has read privilege over the tuple table in
question (otherwise returning <code class="docutils literal notranslate"><span class="pre">UNDEF</span></code>). If the user does have the necessary privileges,
the <code class="docutils literal notranslate"><span class="pre">?Type</span></code> variable is bound to a string reflecting the type of the tuple table,
variable <code class="docutils literal notranslate"><span class="pre">?ID</span></code> to a unique integer ID of the tuple table, while variables <code class="docutils literal notranslate"><span class="pre">?MinArity</span></code>
and <code class="docutils literal notranslate"><span class="pre">?MaxArity</span></code> to the minimum and maximum numbers of arguments of atoms that refer to
the tuple table.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/tupletables</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,Type,ID,MinArity,MaxArity
DefaultTriples,memory,1,3,3
Quads,,,,
[...]
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">TupleTableInfo</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">tupleTableInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">listTupleTables</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-information-about-a-tuple-table">
<h3><span class="section-number">16.11.2. </span>Retrieving Information About a Tuple Table<a class="headerlink" href="#retrieving-information-about-a-tuple-table" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves information about a tuple table. The response
is written as an output of a SPARQL query that binds variables <code class="docutils literal notranslate"><span class="pre">?Property</span></code>
and <code class="docutils literal notranslate"><span class="pre">?Value</span></code>. The exact properties and values are determined by the tuple
table type.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/tupletables/myTable</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,DefaultTriples
type,memory
ID,1
min-arity,3
max-arity,3
... etc ...
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TupleTableInfo</span></code> class encapsulates information about a tuple table in
the Java API. Instances of this class are immutable.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">TupleTableInfo</span><span class="w"> </span><span class="n">tupleTableInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">describeTupleTable</span><span class="p">(</span><span class="s">&quot;myTable&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-tuple-table">
<h3><span class="section-number">16.11.3. </span>Creating a Tuple Table<a class="headerlink" href="#creating-a-tuple-table" title="Permalink to this headline">¶</a></h3>
<p>The following request creates a new tuple table, which can be either an
in-memory tuple table or a tuple table backed by a data source. Creating a
tuple table requires specifying the table name via the query string of the URI.
Optional tuple table parameters can also be provided in this way. For more
details see <a class="reference internal" href="tuple-tables.html#tuple-tables"><span class="std std-numref">Section 6</span></a>. Tuple table creation cannot be
performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/tupletables/myTable?key1=val1&amp;key2=val2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/tupletables/myTable</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val1&quot;</span><span class="p">);</span>
<span class="n">parameters</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;val2&quot;</span><span class="p">);</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">createTupleTable</span><span class="p">(</span><span class="s">&quot;myTable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-tuple-table">
<h3><span class="section-number">16.11.4. </span>Deleting a Tuple Table<a class="headerlink" href="#deleting-a-tuple-table" title="Permalink to this headline">¶</a></h3>
<p>The following request deletes a tuple table, which can be either an in-memory
tuple table or a tuple table backed by a data source. The request succeeds only
if a tuple table is not used in a rule currently loaded in the data store.
Tuple table deletion cannot be performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/tupletables/myTable</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">deleteTupleTable</span><span class="p">(</span><span class="s">&quot;myTable&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-statistics">
<h2><span class="section-number">16.12. </span>Managing Statistics<a class="headerlink" href="#managing-statistics" title="Permalink to this headline">¶</a></h2>
<p>Like most databases, RDFox needs in its operation various statistics about the
data it contains. These are mainly used for query planning: when determining
how to efficiently evaluate a query, RDFox consults information gathered from
the data in a data store in order to estimate which query evaluation plan is
more likely to be efficient. These statistics can be managed explicitly through
the core and REST APIs. Configuring the available statistics is largely of
interest for system administrator. Moreover, after large updates (e.g., after a
large amount of data is added to the system), it is advisable to update the
statistics — that is, to request RDFox to recompute all summaries from the data
currently available in the system.</p>
<div class="section" id="listing-the-available-statistics">
<h3><span class="section-number">16.12.1. </span>Listing the Available Statistics<a class="headerlink" href="#listing-the-available-statistics" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of statistics currently available in a
data store. The response is written as an output of a SPARQL query that binds
variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the name of the statistics, and variable <code class="docutils literal notranslate"><span class="pre">?Parameters</span></code>
to a string describing the data source parameters (with all key-value pairs
concatenated as in a query string).</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/stats</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name,Parameters
column-counts,
[...]
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">StatisticsInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">statisticsInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">listStatistics</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-information-about-statistics">
<h3><span class="section-number">16.12.2. </span>Retrieving Information About Statistics<a class="headerlink" href="#retrieving-information-about-statistics" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves information about statistics. The response is
written as an output of a SPARQL query that binds variables <code class="docutils literal notranslate"><span class="pre">?Property</span></code> and
<code class="docutils literal notranslate"><span class="pre">?Value</span></code>. The exact properties and values are determined by the statistics.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/stats/column-counts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,column-counts
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">statisticsInfo</span></code> class encapsulates information about the statistics in
the Java API. Instances of this class are immutable.</p>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">StatisticsInfo</span><span class="w"> </span><span class="n">statisticsInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">describestatistics</span><span class="p">(</span><span class="s">&quot;column-counts&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-statistics">
<h3><span class="section-number">16.12.3. </span>Creating Statistics<a class="headerlink" href="#creating-statistics" title="Permalink to this headline">¶</a></h3>
<p>The following request creates new statistics. Request parameters that customize
the newly created object can be specified via the query string of the request
URI. The location of the new statistics is returned in the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header.
Creation of statistics cannot be performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/stats/column-counts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/stats/column-counts</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">createStatistics</span><span class="p">(</span><span class="s">&quot;column-counts&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-statistics">
<h3><span class="section-number">16.12.4. </span>Deleting Statistics<a class="headerlink" href="#deleting-statistics" title="Permalink to this headline">¶</a></h3>
<p>The following request deletes the statistics with the given name.
Deletion of statistics cannot be performed as part of an explicit transaction.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/stats/column-counts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">dsConn</span><span class="p">.</span><span class="na">deleteStatistics</span><span class="p">(</span><span class="s">&quot;column-counts&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-statistics">
<h3><span class="section-number">16.12.5. </span>Updating Statistics<a class="headerlink" href="#updating-statistics" title="Permalink to this headline">¶</a></h3>
<p>The following request updates all statistics currently present in the data
store.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/stats</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">StatisticsInfo</span><span class="w"> </span><span class="n">statisticsInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">updateStatistics</span><span class="p">();</span>
</pre></div>
</div>
<p>The following request updates only the statistics with the given name.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/datastores/myStore/stats/column-counts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">StatisticsInfo</span><span class="w"> </span><span class="n">statisticsInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">updateStatistics</span><span class="p">(</span><span class="s">&quot;column-counts&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="evaluating-queries">
<span id="apis-evaluating-queries"></span><h2><span class="section-number">16.13. </span>Evaluating Queries<a class="headerlink" href="#evaluating-queries" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">/sparql</span></code> key exposes a <a class="reference external" href="http://www.w3.org/TR/sparql11-protocol/">SPARQL 1.1 endpoint</a> implemented exactly as in the
specification. Both <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">POST</span></code> request methods are supported.
Moreover, <code class="docutils literal notranslate"><span class="pre">SELECT/ASK</span></code> and <code class="docutils literal notranslate"><span class="pre">CONSTRUCT</span></code> query operations, and
<code class="docutils literal notranslate"><span class="pre">DELETE/INSERT</span></code> update operations, are supported. Query evaluation in RDFox
can be influenced using a number of parameters, which can be specified via the
query string of the URI. The answer to the SPARQL query is encoded according to
the required format, and a request fails if the format does not match the query
type (e.g., if a request specifies a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> query and the Turtle answer
format).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">base</span></code> query parameter can be used to specify an IRI that will be used as
the default base IRI when processing the query.</p>
<p>In order to prevent the RDFox endpoint from hanging for a long time, query
evaluation requests can be subjected to time limits. Endpoint configuration
options <code class="docutils literal notranslate"><span class="pre">query-time-limit</span></code> and <code class="docutils literal notranslate"><span class="pre">allow-query-time-limit-override</span></code> and
RDFox-proprietary HTTP header <code class="docutils literal notranslate"><span class="pre">Query-Time-Limit</span></code> can be used to configure
these limits, and they are described in <a class="reference internal" href="rdfox-endpoint.html#endpoint-parameters"><span class="std std-numref">Section 19.2</span></a>.</p>
<p>The following is an example of a query request.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/sparql?query=SELECT+%3FX+%3FY+%3FZ+WHERE+{+%3FX+%3FY+%3FZ+}</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

X,Y,Z
[...result of the query...]
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">compilationParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="c1">// SPARQL evaluation supports a bunch of parameters that govern how</span>
<span class="c1">// SPARQL statements are compiled.</span>
<span class="n">compilationParameters</span><span class="p">.</span><span class="na">set</span><span class="p">(...,</span><span class="w"> </span><span class="p">...);</span>
<span class="c1">// SPARQL evaluation can return either a set of results (in the case of</span>
<span class="c1">// SELECT/ASK/CONSTRUCT queries) or nothing (in the case of UPDATEs).</span>
<span class="c1">// It seems useful to have an API that can evaluate any SPARQL string,</span>
<span class="c1">// regardless of whether it contains a query or update. Therefore, the</span>
<span class="c1">// following function requires two parameters:</span>
<span class="c1">//</span>
<span class="c1">// * an output stream to which answers are written (if there are any),</span>
<span class="c1">// * the name of a SPARQL answer format.</span>
<span class="c1">//</span>
<span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">evaluateStatement</span><span class="p">(</span><span class="s">&quot;SELECT ?S ?P ?O WHERE { ?S ?P ?O }&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">compilationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/csv&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>SPARQL supports pagination of query results using <code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> and <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>
query clauses; however, evaluating the same query while varying its
<code class="docutils literal notranslate"><span class="pre">OFFSET/LIMIT</span></code> clauses may be inefficient because the query in each request
is evaluated from scratch.</p>
<p>In the RESTful API, including the <code class="docutils literal notranslate"><span class="pre">offset=m;limit=n</span></code> parameters into a query
request has the same effect as adding the <code class="docutils literal notranslate"><span class="pre">OFFSET</span> <span class="pre">m</span> <span class="pre">LIMIT</span> <span class="pre">n</span></code> clauses to the
query. However, doing the former can be more efficient when</p>
<ul class="simple">
<li><p>a user makes a query request with <code class="docutils literal notranslate"><span class="pre">offset=m1;limit=n1</span></code>,</p></li>
<li><p>the same user makes another request for exactly the same query (i.e., a
query that is character-for-character identical as the previous one) with
<code class="docutils literal notranslate"><span class="pre">offset=m2;limit=n2</span></code> where <code class="docutils literal notranslate"><span class="pre">m2</span> <span class="pre">=</span> <span class="pre">m1</span> <span class="pre">+</span> <span class="pre">n1</span> <span class="pre">+</span> <span class="pre">1</span></code>, and</p></li>
<li><p>the data store has not been updated between these two requests.</p></li>
</ul>
<p>RDFox provides no hard efficiency guarantees, but will try to process
requests containing <code class="docutils literal notranslate"><span class="pre">offset=m;limit=n</span></code> as efficiently as possible.
Therefore, applications should use this approach to result pagination
whenever possible. The <code class="docutils literal notranslate"><span class="pre">endpoint.object-keep-alive-time</span></code> option specifies
the rough amount of time between two such requests for the same query
during which RDFox will aim to speed up query evaluation.</p>
<p>SPARQL queries can be long in some applications, so sending the same query
multiple times can be a considerable source of overhead. In such cases,
applications can consider using cursors (See <a class="reference internal" href="#apis-cursors"><span class="std std-numref">Section 16.15</span></a>), where a
query is submitted for execution just once.</p>
</div>
<div class="section" id="working-with-transactions">
<span id="apis-working-with-transactions"></span><h2><span class="section-number">16.14. </span>Working with Transactions<a class="headerlink" href="#working-with-transactions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transactions-in-the-java-api">
<h3><span class="section-number">16.14.1. </span>Transactions in the Java API<a class="headerlink" href="#transactions-in-the-java-api" title="Permalink to this headline">¶</a></h3>
<p>In the Java API, each transaction is associated with one data store connection.
The <code class="docutils literal notranslate"><span class="pre">DataStoreConnection</span></code> class provides <code class="docutils literal notranslate"><span class="pre">beginTransaction()</span></code>,
<code class="docutils literal notranslate"><span class="pre">commitTransaction()</span></code>, and <code class="docutils literal notranslate"><span class="pre">rollbackTransaction()</span></code> functions, which
respectively start, commit, and roll back a transaction.</p>
<p>If no transaction is associated with a connection, then data store modification
functions and query evaluation functions start a transaction that is committed
or rolled back before the function finishes. In contrast, if a transaction is
started on a connection when a modification/query function is called, then the
operation is evaluated within the context of that transaction.</p>
<p>A transaction remains open in the Java API as long as it is not explicitly
committed or rolled back. Closing a connection with a running transaction will
rollback the transaction first.</p>
<p>Data store connections are single-threaded objects: attempting to use the same
object in parallel from multiple threads will result in unpredictable behavior
and is likely to crash the system. (However, the same data store connection
object can be used from different threads at distinct time points — that is,
there is no affinity between connection objects and threads.) In order to
access RDFox concurrently, one should use distinct connections, each running a
separate transaction.</p>
</div>
<div class="section" id="transactions-in-the-restful-api">
<span id="rest-transactions"></span><h3><span class="section-number">16.14.2. </span>Transactions in the RESTful API<a class="headerlink" href="#transactions-in-the-restful-api" title="Permalink to this headline">¶</a></h3>
<p>The RESTful API follows the same principles and associates transactions with
data store connections. To use transactions in the RESTful API, one must
explicitly create a connection (see
<a class="reference internal" href="#rest-explicit-connection-management"><span class="std std-numref">Section 16.2.5</span></a>). To start, commit, or rollback a
transaction, one can issue a <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request to the
<code class="docutils literal notranslate"><span class="pre">/datastores/&lt;DSTRNAME&gt;/connections/&lt;DSCONN&gt;/transaction</span></code> key with the
<code class="docutils literal notranslate"><span class="pre">operation</span></code> request parameter set to <code class="docutils literal notranslate"><span class="pre">begin-read-only-transaction</span></code>,
<code class="docutils literal notranslate"><span class="pre">begin-read-write-transaction</span></code>, <code class="docutils literal notranslate"><span class="pre">commit-transaction</span></code>, or
<code class="docutils literal notranslate"><span class="pre">rollback-transaction</span></code>. After this, any operation evaluated on this
connection (which can be achieved by including the <code class="docutils literal notranslate"><span class="pre">connection</span></code> request
parameter) will be evaluated inside the transaction associated with the
connection.</p>
<p>For example, the following sequence of requests creates a connection to the
<code class="docutils literal notranslate"><span class="pre">myStore</span></code> data store, starts a read/write transaction on the new connection,
imports data twice, and commits the transaction. Please note that, although the
transaction has been committed, the connection persists after the last request.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/connections</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/connections/01234567890123456789</span>
</pre></div>
</div>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/transaction?operation=begin-read-write-transaction</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content?connection=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[First batch of facts/rules]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Response body as usual]
</pre></div>
</div>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content?connection=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[Second batch of facts/rules]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[Response body as usual]
</pre></div>
</div>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/transaction?operation=commit-transaction</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>At any point, one can see whether a connection is associated with a transaction
as follows. The response is written as the output of a SPARQL query that binds
the variable <code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the property name, variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to the
property value, and variable <code class="docutils literal notranslate"><span class="pre">?Mutable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> if the value of the
property can be changed and to <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/transaction</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value,Mutable
transaction-state,read-write,false
transaction-requires-rollback,false,false
last-transaction-data-store-version,5,false
</pre></div>
</div>
</div>
</div>
<div class="section" id="cursors">
<span id="apis-cursors"></span><h2><span class="section-number">16.15. </span>Cursors<a class="headerlink" href="#cursors" title="Permalink to this headline">¶</a></h2>
<p>As already mentioned in <a class="reference internal" href="#apis-evaluating-queries"><span class="std std-numref">Section 16.13</span></a>, RDFox supports
efficient APIs for paginating query results using cursors, which provide a view
into the results of a query evaluated on a ‘frozen’ snapshot of data. The
concept of cursors is used in slightly different ways in the Core and the
RESTful APIs, so this section discusses first the former and then the latter.</p>
<div class="section" id="cursors-in-the-java-api">
<h3><span class="section-number">16.15.1. </span>Cursors in the Java API<a class="headerlink" href="#cursors-in-the-java-api" title="Permalink to this headline">¶</a></h3>
<p>The Java API uses cursors to provide access to answers to queries. A cursor
goes through the following life cycle.</p>
<ul class="simple">
<li><p>When a cursor is created, it is in an <em>unopened</em> state.</p></li>
<li><p>Before it is used, a cursor must be opened, which positions the cursor on the
first answer tuple, or at the answer end if there are no answer tuples.
Opening the cursor returns the multiplicity of the current answer, or zero if
there are no answers.</p></li>
<li><p>Advancing a cursor returns the multiplicity of the next row. Cursors cannot
go backwards — all movement is forward.</p></li>
<li><p>A cursor can at any point be reopened, in which case the query underlying the
cursor is reevaluated afresh. By creating cursors for queries that are
evaluated many times, applications can speed up query processing by avoiding
the overhead of parsing and compiling the query in each request.</p></li>
<li><p>When a cursor is no longer needed, it must be closed so that any resources
associated with it can be released. This must be done even when cursors are
read to the end. In Java, the <code class="docutils literal notranslate"><span class="pre">Cursor</span></code> class implements the
<code class="docutils literal notranslate"><span class="pre">AutoCloseable</span></code> interface so that it can be used in a try-with-resources
statement.</p></li>
</ul>
<p>The reason why rows have multiplicities is because SPARQL has bag semantics, and
if an answer contains the same tuple <code class="docutils literal notranslate"><span class="pre">n</span></code> times, it can be more efficient to
return the tuple once and say that the tuple’s multiplicity is <code class="docutils literal notranslate"><span class="pre">n</span></code>. The Java
API supports cursors for <code class="docutils literal notranslate"><span class="pre">SELECT/ASK</span></code> and <code class="docutils literal notranslate"><span class="pre">CONSTRUCT</span></code> queries. A cursor for
a <code class="docutils literal notranslate"><span class="pre">CONSTRUCT</span></code> query behaves as a cursor for a <code class="docutils literal notranslate"><span class="pre">SELECT/ASK</span></code> query returning
variables <code class="docutils literal notranslate"><span class="pre">?S</span></code>, <code class="docutils literal notranslate"><span class="pre">?P</span></code>, and <code class="docutils literal notranslate"><span class="pre">?O</span></code> for each constructed triple.</p>
<p>Each cursor is associated with a data store connection that it is created on.
Moreover, all operations on a cursor are evaluated in the context of a
connection transaction. For example, if a transaction is running on the
connection when a cursor is opened, then opening the cursor is performed within
this transaction. Moreover, if no transaction is running on the connection when
a cursor is opened, a temporary read-only transaction is started, the cursor is
opened, and the transaction is rolled back. A cursor is advanced analogously,
possibly starting a temporary transaction each time it is advanced.</p>
<p>The use of temporary transactions opens a potential consistency problem, which
is illustrated by the following sequence of actions.</p>
<ul class="simple">
<li><p>Create a cursor on a connection not associated with a transaction.</p></li>
<li><p>Open a cursor (which implicitly creates a temporary transaction for the
duration of the operation).</p></li>
<li><p>Modify the content on the data store using a different connection. Since the
cursor’s connection is not associated with a transaction, modification is
possible, and it can affect the results of the query produced by the cursor.</p></li>
<li><p>Advance the cursor. At this point, RDFox will detect that the data store has
changed since the cursor was opened, and, to inform the user of this fact, it
would throw <code class="docutils literal notranslate"><span class="pre">StaleCursorException</span></code>. In this way, RDFox prevents users from
possibly overlooking the effects of updates applied to the data store while
the cursor is being used. Please note that RDFox will throw
<code class="docutils literal notranslate"><span class="pre">StaleCursorException</span></code> even if the update does not affect the cursor’s
result — that is, RDFox’s consistency mechanism is pessimistic.</p></li>
</ul>
<p>Please note that <code class="docutils literal notranslate"><span class="pre">StaleCursorException</span></code> can happen only if the cursor uses
temporary transactions in open and advance. In other words, the the cursor is
opened and advanced within a single, uninterrupted transaction, then
<code class="docutils literal notranslate"><span class="pre">StaleCursorException</span></code> cannot happen.</p>
<p>Cursors are typically used in the Java API as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Map&lt;String, String&gt; parameters = new HashMap&lt;String, String&gt;();
// Initialize parameters that govern query evaluation.
parameters.set(..., ...);
// Create the cursor.
Cursor crs = dsConn.createCursor(&quot;SELECT ?X ?Y ?Z WHERE { ?X ?Y ?Z }&quot;, parameters);
for (long multiplicity = crs.open(); multiplicity != 0; multiplicity = crs.advance()) {
    // Read the current answer
}
crs.close();
</pre></div>
</div>
</div>
<div class="section" id="cursors-in-the-restful-api">
<h3><span class="section-number">16.15.2. </span>Cursors in the RESTful API<a class="headerlink" href="#cursors-in-the-restful-api" title="Permalink to this headline">¶</a></h3>
<p>The RESTful API supports efficient query result pagination using the
<code class="docutils literal notranslate"><span class="pre">offset=m;limit=n</span></code> request parameters (see
<a class="reference internal" href="#apis-evaluating-queries"><span class="std std-numref">Section 16.13</span></a>). However, this style of result pagination
requires resending the same query in each request, which can be inefficient.
Moreover, applications relying on the RESTful API might also benefit from
precompiling common queries into cursors that are managed explicitly.</p>
<p>To support such use cases, the RESTful API supports explicit cursor management
that mimics the Java cursor API. Each cursor is identified by an ID exposed
under the <code class="docutils literal notranslate"><span class="pre">/datastores/&lt;DSTRNAME&gt;/connections/&lt;DSCONN&gt;/cursors</span></code> key; note
that this arrangement reflects the fact that each cursor is associated with a
specific data store connection. When a data store connection is deleted, all
cursors associated with the connection are deleted as well. Each cursor exposed
by the RESTful API maintains its position, and there is an API allowing users
to query the current cursor position.</p>
<div class="section" id="listing-available-cursors">
<h4><span class="section-number">16.15.2.1. </span>Listing Available Cursors<a class="headerlink" href="#listing-available-cursors" title="Permalink to this headline">¶</a></h4>
<p>The following request retrieves the list of cursors available on a server
transaction. The response is written as an output of a SPARQL query that binds
variable <code class="docutils literal notranslate"><span class="pre">?CursorID</span></code> to the cursor ID.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/cursors</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

CursorID
CRS101
CRS102
</pre></div>
</div>
</div>
<div class="section" id="creating-a-cursor">
<h4><span class="section-number">16.15.2.2. </span>Creating a Cursor<a class="headerlink" href="#creating-a-cursor" title="Permalink to this headline">¶</a></h4>
<p>A cursor is created by submitting the query to the <code class="docutils literal notranslate"><span class="pre">/cursors</span></code> key using the
<code class="docutils literal notranslate"><span class="pre">POST</span></code> method of the <a class="reference external" href="http://www.w3.org/TR/sparql11-protocol/">SPARQL 1.1 Protocol</a>. The location of the new cursor is
returned in the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">base</span></code> query parameter can be used to specify an IRI that will be used as
the default base IRI when processing the query.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/cursors</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/sparql-query</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">34</span>

<span class="k">SELECT</span> <span class="nv">?X</span> <span class="nv">?Y</span> <span class="nv">?Z</span> <span class="k">WHERE</span> <span class="p">{</span> <span class="nv">?X</span> <span class="nv">?Y</span> <span class="nv">?Z</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">CREATED</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/datastores/myStore/connections/01234567890123456789/cursors/CRS101</span>
</pre></div>
</div>
</div>
<div class="section" id="opening-and-advancing-a-cursor">
<h4><span class="section-number">16.15.2.3. </span>Opening and Advancing a Cursor<a class="headerlink" href="#opening-and-advancing-a-cursor" title="Permalink to this headline">¶</a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request on the cursor opens or advances the cursor; to distinguish
the two, the <code class="docutils literal notranslate"><span class="pre">operation</span></code> request parameter must be included with value
<code class="docutils literal notranslate"><span class="pre">open</span></code> or <code class="docutils literal notranslate"><span class="pre">advance</span></code>. Moreover, request can include <code class="docutils literal notranslate"><span class="pre">limit=n</span></code> parameter
determining how many rows should be returned; if this parameter is absent, all
remaining rows are returned. Parameter <code class="docutils literal notranslate"><span class="pre">limit=0</span></code> can be used to specify that
no answers should be returned (and so the request just validates the cursor).
The request updates the cursor position and so such a request is not
idempotent; consequently, the request method is <code class="docutils literal notranslate"><span class="pre">PATCH</span></code>. In all such cases,
the request must specify an <code class="docutils literal notranslate"><span class="pre">Accept</span></code> header to determine the format of the
returned data. Different requests on the same cursor can request different
result formats.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/cursors/CRS101?operation=open&amp;limit=10</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>

[The first 10 answers to the query in CSV format]
</pre></div>
</div>
</div>
<div class="section" id="retrieving-cursor-information">
<h4><span class="section-number">16.15.2.4. </span>Retrieving Cursor Information<a class="headerlink" href="#retrieving-cursor-information" title="Permalink to this headline">¶</a></h4>
<p>The following request retrieves information about a specific cursor. The
response is written as an output of a SPARQL query that binds variable
<code class="docutils literal notranslate"><span class="pre">?Property</span></code> to the name of a cursor property, and variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> to
property value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/cursors/CRS101</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
ID,CRS1
position,10
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-cursor">
<h4><span class="section-number">16.15.2.5. </span>Deleting a Cursor<a class="headerlink" href="#deleting-a-cursor" title="Permalink to this headline">¶</a></h4>
<p>The following request closes/deletes the cursor.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/datastores/myStore/connections/01234567890123456789/cursors/CRS101</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="explaining-fact-derivation">
<span id="apis-explaining-reasoning"></span><h2><span class="section-number">16.16. </span>Explaining Fact Derivation<a class="headerlink" href="#explaining-fact-derivation" title="Permalink to this headline">¶</a></h2>
<p>RDFox allows clients to supply a fact and retrieve an explanation of how a fact
is derived from the facts explicitly given in the input using rules. An
explanation consists of one or more chains of rule applications that derive the
target fact.</p>
<p>In the RESTful API, an explanation of how a fact is derived can be retrieved
using the <code class="docutils literal notranslate"><span class="pre">/explanation</span></code> key. This key takes the following request parameters.</p>
<ul class="simple">
<li><p>The mandatory <code class="docutils literal notranslate"><span class="pre">fact</span></code> request parameter specifies the fact for which the
explanation is to be produced. The fact should be written using the standard
Datalog syntax. IRIs in the fact can be abbreviated using the prefixes of the
data store.</p></li>
<li><p>The optional <code class="docutils literal notranslate"><span class="pre">type</span></code> parameter specifies the type of explanation that is to
be retrieved.</p>
<ul>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">shortest</span></code> specifies that one shortest explanation should be
returned. That is, the explanation shows one shortest way in which the
specified fact can be derived from the facts explicitly given in the input
using rules. This is the default value for the <code class="docutils literal notranslate"><span class="pre">type</span></code> parameter.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">to-explicit</span></code> specifies that all possible ways to derive the
specified fact from explicit facts should be returned.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">exhaustive</span></code> specifies that all possible ways to derive the
specified fact should be returned. This option differs from <code class="docutils literal notranslate"><span class="pre">to-explicit</span></code>
and <code class="docutils literal notranslate"><span class="pre">shortest</span></code> in that, if explicit facts are also derived by rules,
these inferences are explained as well; in contrast, with <code class="docutils literal notranslate"><span class="pre">to-explicit</span></code>
and <code class="docutils literal notranslate"><span class="pre">shortest</span></code>, the explicit facts are not further explained.</p></li>
</ul>
</li>
<li><p>The optional <code class="docutils literal notranslate"><span class="pre">max-distance-from-root</span></code> numeric parameter can be used to
specify the depth to which an explanation should be explored. That is, facts
that require more than this number of rule applications are not explained
themselves. This parameter can be used to limit the size of the explanation
produced by RDFox. If a value for this parameter is not specified, the
maximum depth is unlimited.</p></li>
<li><p>The optional <code class="docutils literal notranslate"><span class="pre">max-rule-instances-per-fact</span></code> numeric parameter can be used to
specify maximum number of ways of deriving a single fact that RDFox should
explore. This parameter can be used to limit the size of the explanation
produced by RDFox. If a value for this parameter is not specified, the
maximum depth is unlimited.</p></li>
</ul>
<p>The Java API takes the same parameters, but coded as method arguments. The
resulting explanation is serialized as a JSON object using the format discussed
below. The IRIs of facts and constants in the output are serialized using the
prefixes of the data store. In the RESTful API, the content type of the output
is set to <code class="docutils literal notranslate"><span class="pre">application/x.explanation+json</span></code>.</p>
<p>The output format is described using the following example. Let us assume that
a data store contains the following triples.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:a :R :b .
:a :R :c .
:a rdf:type :B .
:a rdf:type :D .
</pre></div>
</div>
<p>Moreover, let us assume that the data store contains the following rules.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:A[?X] :- :R[?X,?Y] .
:A[?X] :- :B[?X], NOT :C[?X] .
:B[?X] :- :D[?X] .
</pre></div>
</div>
<p>Clearly, fact <code class="docutils literal notranslate"><span class="pre">:A[:a]</span></code> is derived in this data store using the following
three rule instances:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:A[:a] :- :R[:a,:b] .
:A[:a] :- :R[:a,:c] .
:A[:a] :- :B[:a], NOT :C[:a] .
</pre></div>
</div>
<p>Moreover, fact <code class="docutils literal notranslate"><span class="pre">:B[:a]</span></code> is explicitly given in the input, but it is also
derived by the following rule instance.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>:B[:a] :- :D[:a] .
</pre></div>
</div>
<p>When asked to produce a shortest explanation for fact <code class="docutils literal notranslate"><span class="pre">:A[:a]</span></code>, RDFox might
return the following JSON object.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> { &quot;prefixes&quot;: {
    &quot;:&quot;: &quot;http://example.com/&quot;,
    &quot;owl:&quot;: &quot;http://www.w3.org/2002/07/owl#&quot;,
    &quot;rdf:&quot;: &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;,
    &quot;rdfox:&quot;: &quot;https://rdfox.com/vocabulary#&quot;,
    &quot;rdfs:&quot;: &quot;http://www.w3.org/2000/01/rdf-schema#&quot;,
    &quot;sh:&quot;: &quot;http://www.w3.org/ns/shacl#&quot;,
    &quot;swrl:&quot;: &quot;http://www.w3.org/2003/11/swrl#&quot;,
    &quot;swrlb:&quot;: &quot;http://www.w3.org/2003/11/swrlb#&quot;,
    &quot;xsd:&quot;: &quot;http://www.w3.org/2001/XMLSchema#&quot; },
  &quot;complete&quot;: true,
  &quot;facts&quot;: {
    &quot;0&quot;: {
      &quot;fact&quot;: &quot;:A[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;derived&quot;,
      &quot;distance-from-root&quot;: 0,
      &quot;proof-height&quot;: 1,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: 0,
      &quot;rule-instances&quot;: [
        { &quot;rule&quot;: &quot;:A[?X] :- :B[?X], NOT :C[?X] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-Tup
leTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;
/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox
-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
 .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;1&quot;, null ] } ] },
    &quot;1&quot;: {
      &quot;fact&quot;: &quot;:B[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] }
} }
</pre></div>
</div>
<p>Each explanation consists of a number of facts, each of which is identified by
a numeric identified. The <code class="docutils literal notranslate"><span class="pre">facts</span></code> JSON objects contains all facts indexed by
their key. The facts with the zero identifier is the root of the explanation
— that is, this is the fact for which the explanation was requested. Each
fact has the following properties.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">fact</span></code> key contains the fact using Datalog syntax. Each argument is
encoded in the same way as a binding object in the
<code class="docutils literal notranslate"><span class="pre">application/x.sparql-results+json-abbrev</span></code> query answer format.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">fact-structured</span></code> key contains the fact using Datalog syntax with
structural annotations.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> key describes the kind of fact: <code class="docutils literal notranslate"><span class="pre">explicit</span></code> mean that the fact
was explicitly given in the input; <code class="docutils literal notranslate"><span class="pre">derived</span></code> means that the fact was not
explicitly given in the input but was derived by one or more rules; and
<code class="docutils literal notranslate"><span class="pre">false</span></code> means that the fact is neither explicitly given nor derived. The
value of <code class="docutils literal notranslate"><span class="pre">false</span></code> is possible only for the root fact.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">distance-from-root</span></code> key specifies how far a particular fact is from
the root: this value is zero for the root fact, the facts that are used to
derive the root fact have distance one, and so on.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">proof-height</span></code> key specifies the least number of rule applications
needed to derive a fact. This number is zero for explicit facts, it is one
for facts derived from the explicit facts using one rule application, and so
on. The value of this key can be <code class="docutils literal notranslate"><span class="pre">null</span></code> when the <code class="docutils literal notranslate"><span class="pre">max-distance-from-root</span></code>
and <code class="docutils literal notranslate"><span class="pre">max-rule-instances-per-fact</span></code> parameters prevent RDFox from exploring
all rule instances necessary to identify the shortest proof.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">rule-instances-complete</span></code> key contains a Boolean value specifying
whether RDFox has explored all rule instances that derive this fact. In
particular, this value will be <code class="docutils literal notranslate"><span class="pre">false</span></code> if the value of
<code class="docutils literal notranslate"><span class="pre">distance-from-root</span></code> is larger than the <code class="docutils literal notranslate"><span class="pre">max-distance-from-root</span></code>
parameter, or if more than <code class="docutils literal notranslate"><span class="pre">max-rule-instances-per-fact</span></code> rule instances
derive the fact.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">rule-instances</span></code> key contains an array of rule instances that derive
the given fact. Each rule instance is a JSON object with the structure
specified below.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">shortest-proof-rule-instance</span></code> key contains a numeric zero-based index
of the rule instance from the <code class="docutils literal notranslate"><span class="pre">rule-instances</span></code> that belongs to a shortest
proof for this fact. The value of this key can be <code class="docutils literal notranslate"><span class="pre">null</span></code> when the
<code class="docutils literal notranslate"><span class="pre">max-distance-from-root</span></code> and <code class="docutils literal notranslate"><span class="pre">max-rule-instances-per-fact</span></code> parameters
prevent RDFox from exploring all rule instances necessary to identify the
shortest proof.</p></li>
</ul>
<p>Each rule instance is encoded as a JSON object with the following structure.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">rule</span></code> key contains the rule written using Datalog syntax. Any IRI
inside the rule is serialized using the prefixes used in the request.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">rule-structured</span></code> key contains the rule written using Datalog syntax
with structural annotations.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">grounded-rule-structured</span></code> key contains the rule instance written using
Datalog syntax with structural annotations.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">head-atom-index</span></code> key contains the index of the head atom of the rule
that participated in the inference. That is, fact that mentions this rule
instance is derived by the head atom of the rule with the specified index.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">body-facts</span></code> key contains an array of IDs of facts that are matched to
the body formulas of the rule in the inference. In our example, there is one
instance of rule <code class="docutils literal notranslate"><span class="pre">:A[?X]</span> <span class="pre">:-</span> <span class="pre">:B[?X],</span> <span class="pre">NOT</span> <span class="pre">:C[?X]</span> <span class="pre">.</span></code> that contains <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">&quot;1&quot;,</span>
<span class="pre">null</span> <span class="pre">]</span></code> as the value for <code class="docutils literal notranslate"><span class="pre">body-facts</span></code>, which should be interpreted as
follows. The first element of the array is <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code>, which means that the
first formula in the rule body is an atom that is matched to a fact whose ID
<code class="docutils literal notranslate"><span class="pre">1</span></code>. The second element of the array is <code class="docutils literal notranslate"><span class="pre">null</span></code>, which means that the
second formula in the rule body is not an atom and is thus not directly
matched to facts.</p></li>
</ul>
<p>Since only a shortest explanation is required, the above JSON object presents
just one way to derive fact <code class="docutils literal notranslate"><span class="pre">:A[:a]</span></code>. Note that several rule instances derive
this fact in the same number of steps, but RDFox selects just one of them.</p>
<p>With the <code class="docutils literal notranslate"><span class="pre">to-explicit</span></code> option, RDFox produces the following explanation. The
structure of the JSON object is the same as before, but all possible ways to
derive <code class="docutils literal notranslate"><span class="pre">:A[:a]</span></code> from explicit facts are shown. Note, however, that fact
<code class="docutils literal notranslate"><span class="pre">:B[:a]</span></code> is not further explained since it is an explicit fact.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ &quot;prefixes&quot;: {
    &quot;:&quot;: &quot;http://example.com/&quot;,
    &quot;owl:&quot;: &quot;http://www.w3.org/2002/07/owl#&quot;,
    &quot;rdf:&quot;: &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;,
    &quot;rdfox:&quot;: &quot;https://rdfox.com/vocabulary#&quot;,
    &quot;rdfs:&quot;: &quot;http://www.w3.org/2000/01/rdf-schema#&quot;,
    &quot;sh:&quot;: &quot;http://www.w3.org/ns/shacl#&quot;,
    &quot;swrl:&quot;: &quot;http://www.w3.org/2003/11/swrl#&quot;,
    &quot;swrlb:&quot;: &quot;http://www.w3.org/2003/11/swrlb#&quot;,
    &quot;xsd:&quot;: &quot;http://www.w3.org/2001/XMLSchema#&quot; },
  &quot;complete&quot;: true,
  &quot;facts&quot;: {
    &quot;0&quot;: {
      &quot;fact&quot;: &quot;:A[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;derived&quot;,
      &quot;distance-from-root&quot;: 0,
      &quot;proof-height&quot;: 1,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: 1,
      &quot;rule-instances&quot;: [
        { &quot;rule&quot;: &quot;:A[?X] :- :R[?X, ?Y] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span cl
ass=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;, &lt;span class=\&quot;RDFox-Variable\&quot;&gt;?Y&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;spa
n class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:b&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;1&quot; ] },
        { &quot;rule&quot;: &quot;:A[?X] :- :R[?X, ?Y] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span cl
ass=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;, &lt;span class=\&quot;RDFox-Variable\&quot;&gt;?Y&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;spa
n class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:c&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;2&quot; ] },
        { &quot;rule&quot;: &quot;:A[?X] :- :B[?X], NOT :C[?X] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;s
pan class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span
&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;3&quot;, null ] } ] },
    &quot;1&quot;: {
      &quot;fact&quot;: &quot;:R[:a, :b]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:b&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] },
    &quot;2&quot;: {
      &quot;fact&quot;: &quot;:R[:a, :c]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:c&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] },
    &quot;3&quot;: {
      &quot;fact&quot;: &quot;:B[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] }
} }
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">exhaustive</span></code> option, RDFox produces the following explanation. The
main difference to the previous case is that fact <code class="docutils literal notranslate"><span class="pre">:B[:a]</span></code> is explained even
though it is explicitly given in  the input.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ &quot;prefixes&quot;: {
    &quot;:&quot;: &quot;http://example.com/&quot;,
    &quot;owl:&quot;: &quot;http://www.w3.org/2002/07/owl#&quot;,
    &quot;rdf:&quot;: &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;,
    &quot;rdfox:&quot;: &quot;https://rdfox.com/vocabulary#&quot;,
    &quot;rdfs:&quot;: &quot;http://www.w3.org/2000/01/rdf-schema#&quot;,
    &quot;sh:&quot;: &quot;http://www.w3.org/ns/shacl#&quot;,
    &quot;swrl:&quot;: &quot;http://www.w3.org/2003/11/swrl#&quot;,
    &quot;swrlb:&quot;: &quot;http://www.w3.org/2003/11/swrlb#&quot;,
    &quot;xsd:&quot;: &quot;http://www.w3.org/2001/XMLSchema#&quot; },
  &quot;complete&quot;: true,
  &quot;facts&quot;: {
    &quot;0&quot;: {
      &quot;fact&quot;: &quot;:A[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;derived&quot;,
      &quot;distance-from-root&quot;: 0,
      &quot;proof-height&quot;: 1,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: 1,
      &quot;rule-instances&quot;: [
        { &quot;rule&quot;: &quot;:A[?X] :- :R[?X, ?Y] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span cl
ass=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;, &lt;span class=\&quot;RDFox-Variable\&quot;&gt;?Y&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;spa
n class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:b&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;1&quot; ] },
        { &quot;rule&quot;: &quot;:A[?X] :- :R[?X, ?Y] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span cl
ass=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;, &lt;span class=\&quot;RDFox-Variable\&quot;&gt;?Y&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;spa
n class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:c&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;2&quot; ] },
        { &quot;rule&quot;: &quot;:A[?X] :- :B[?X], NOT :C[?X] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;s
pan class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:A&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span
&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;, &lt;span class=\&quot;RDFox-Negation\&quot;&gt;NOT &lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:C&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;3&quot;, null ] } ] },
    &quot;1&quot;: {
      &quot;fact&quot;: &quot;:R[:a, :b]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:b&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] },
    &quot;2&quot;: {
      &quot;fact&quot;: &quot;:R[:a, :c]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-R-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:R&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;, &lt;span class=\&quot;RDFox-IRI\&quot;&gt;:c&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] },
    &quot;3&quot;: {
      &quot;fact&quot;: &quot;:B[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 1,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [
        { &quot;rule&quot;: &quot;:B[?X] :- :D[?X] .&quot;,
          &quot;rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:D&lt;/span&gt;[&lt;s
pan class=\&quot;RDFox-Variable\&quot;&gt;?X&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;grounded-rule-structured&quot;: &quot;&lt;span class=\&quot;RDFox-Rule\&quot;&gt;&lt;span class=\&quot;RDFox-Rule-head\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:B&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; :- &lt;span class=\&quot;RDFox-Rule-body\&quot;&gt;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:D&lt;/span
&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&lt;/span&gt; .&lt;/span&gt;&quot;,
          &quot;head-atom-index&quot;: 0,
          &quot;body-facts&quot;: [ &quot;4&quot; ] } ] },
    &quot;4&quot;: {
      &quot;fact&quot;: &quot;:D[:a]&quot;,
      &quot;fact-structured&quot;: &quot;&lt;span class=\&quot;RDFox-TupleTableAtom-s-rdftype-o\&quot;&gt;&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:D&lt;/span&gt;[&lt;span class=\&quot;RDFox-IRI\&quot;&gt;:a&lt;/span&gt;]&lt;/span&gt;&quot;,
      &quot;type&quot;: &quot;explicit&quot;,
      &quot;distance-from-root&quot;: 2,
      &quot;proof-height&quot;: 0,
      &quot;rule-instances-complete&quot;: true,
      &quot;shortest-proof-rule-instance&quot;: null,
      &quot;rule-instances&quot;: [ ] }
} }
</pre></div>
</div>
</div>
<div class="section" id="handling-concurrent-updates">
<h2><span class="section-number">16.17. </span>Handling Concurrent Updates<a class="headerlink" href="#handling-concurrent-updates" title="Permalink to this headline">¶</a></h2>
<p>Many applications of RDFox need to gracefully handle concurrent updates by
different users. Although RDFox provides transactions to ensure consistency of
parallel updates, such a construct may be insufficient in examples such as the
following.</p>
<ul class="simple">
<li><p>A graph-like vizualisation of an RDF dataset may initially show just a handful
of RDF resources, and allow users to interactively explore and expand the
neighborhood of each resource. Clearly, it is desirable to show to each user a
consistent view of the data at any given point in time. However, opening a
read-only transaction for the duration of each user’s interaction is
ill-advised as it would prevent the data store from being updated. Instead,
the application might want to detect when the underlying data has changed and
notify the user and/or refresh the view appropriately.</p></li>
<li><p>A common pattern to updating data in applications involves reading current
data, showing the data to the user and allowing them to make changes, and
then writing the data back to the data store. Such operations involves user
interaction, which can take significant time. As a result, it is usually not
desirable to wrap the entire operation in a read/write transaction. Instead,
many applications use ‘optimistic’ concurrency control, where the update
succeeds only if the data store was not updated since the data was shown to
the user; otherwise, the entire process is restarted.</p></li>
</ul>
<p>This section describes aspects of the RDFox API that aim to address these two
problems.</p>
<div class="section" id="detecting-updates">
<span id="apis-detecting-updates"></span><h3><span class="section-number">16.17.1. </span>Detecting Updates<a class="headerlink" href="#detecting-updates" title="Permalink to this headline">¶</a></h3>
<p>Each data store is associated with a 20-digit ID that, at any point in time,
uniquely identifies a data store in the server. Also, RDFox aims to assign
different unique IDs to data stores created at different point in time.</p>
<p>Each data store also maintains a <em>data store version</em>, which is a positive
integer. Each time a data store is updated, the version of the data store is
incremented.</p>
<p>Jointly, a data store unique ID and a data store version identify a particular
state of a data store. That is, if these values are the same between two API
calls, then we know that the data store has not been updated. The converse does
not hold necessarily: even if an update request fails, the version may be
incremented before the failure is detected. Nevertheless, differing unique ID
and/or versions between two API calls indicate with a high degree of
probability that the data store has been updated.</p>
<div class="section" id="java-api">
<h4><span class="section-number">16.17.1.1. </span>Java API<a class="headerlink" href="#java-api" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">DataStoreConnection</span></code> class in Java API provides a <code class="docutils literal notranslate"><span class="pre">getUniqueID()</span></code> and
<code class="docutils literal notranslate"><span class="pre">getDataStoreVersion()</span></code> methods that allow users to retrieve the unique ID
and the data store version, respectively. Moreover, the
<code class="docutils literal notranslate"><span class="pre">getLastTransactionDataStoreVersion()</span></code> method returns the version of the data
store at the point the last transaction was successfully evaluated on this
connection (or <code class="docutils literal notranslate"><span class="pre">0</span></code> if no transaction has been evaluated on this connection).
Thus, by recording the unique ID and the data store version and comparing them
with the values in subsequent requests, an application can detect that a data
store has been updated. Note that the unique ID of a data store never changes
during the lifetime of a data store. Moreover, each data store connection is
associated with just one data store, and so a unique ID can never change on one
connection.</p>
</div>
<div class="section" id="restful-api">
<span id="rest-detecting-updates"></span><h4><span class="section-number">16.17.1.2. </span>RESTful API<a class="headerlink" href="#restful-api" title="Permalink to this headline">¶</a></h4>
<p>The RESTful API exposes these pieces of information as ETags, which are strings
of the form <code class="docutils literal notranslate"><span class="pre">&quot;uniqueID-version&quot;</span></code>. For HTTP requests operating on a data store
or any of its parts, the response will contain a header of the form <code class="docutils literal notranslate"><span class="pre">ETag:</span>
<span class="pre">&quot;uniqueID-version&quot;</span></code> indicating the version of the data store upon request’s
completion. The following example illustrates this on the example of data
importation.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>

[The facts/rules to be added in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">ETag</span><span class="o">:</span> <span class="l">&quot;01234567890123456789-2&quot;</span>

[Response body as usual]
</pre></div>
</div>
<p>In HTTP, an ETag is considered specific to each resource. In RDFox, however,
the same ETag is generated for all resources of a particular data store. Thus,
in the above example, ETag <code class="docutils literal notranslate"><span class="pre">&quot;01234567890123456789-2&quot;</span></code> applies not only to
resource <code class="docutils literal notranslate"><span class="pre">/datastores/myStore/content</span></code>, but also to <code class="docutils literal notranslate"><span class="pre">/datastores/myStore</span></code>
and every resource underneath (such as, say,
<code class="docutils literal notranslate"><span class="pre">/datastores/myStore/content/tupletables</span></code>). In other words, importing the
data into the data store using <code class="docutils literal notranslate"><span class="pre">/datastores/myStore/content</span></code> changes the
ETags of all parts of the data store.</p>
<p>In HTTP, it is customary to return an ETag only on successful responses. In
RDFox, however, an ETag will be returned even in some error responses. This is
in order to keep the user informed about the current data store version as much
as possible. Specifically, most requests are processed as follows.</p>
<ul class="simple">
<li><p>A request is first checked to conform to the RESTful API syntax. For example,
some requests must specify certain request parameters, some requests may not
admit a request body, and so on. In most cases, an ETag will not be sent if a
request cannot be validated properly. The rationale behind this is that
syntactically malformed requests do not match to well-defined RDFox
operations.</p></li>
<li><p>A request is then submitted for execution. If this step fails (e.g., because
the data in an update request is malformed), an ETag will in most cases be
sent in the error response. The rationale behind this is that the request
matches to well-defined RDFox operations, and so knowing the current data
store version might actually be used to recover from failure.</p></li>
</ul>
<p>Since RDFox forms ETags by combining the data store’s unique ID and version
number, neither of which change during the lifetime of a read/write transaction,
returning ETags while such a transaction remains open would lead to the same
ETag value being returned for consecutive requests even if the response body
were different. Such behavior would violate the basic principles of ETags. To
avoid this, RDFox does not send ETags in response to requests that use a data
store connection with an open read/write transaction. The exception to this rule
is when the request has closed the transaction either by committing it or
rolling it back. See <a class="reference internal" href="#rest-transactions"><span class="std std-numref">Section 16.14.2</span></a> for details of how transactions
are managed in the RESTful API.</p>
</div>
</div>
<div class="section" id="conditional-requests">
<h3><span class="section-number">16.17.2. </span>Conditional Requests<a class="headerlink" href="#conditional-requests" title="Permalink to this headline">¶</a></h3>
<p>RDFox can evaluate all operations conditionally — that is, an operation
succeeds only if the data store unique ID and version match specific values
before the request is processed. Note that a naive solution, where a user reads
and compares the data store version before each request, is incorrect: a data
store version can change in the interval between the user reading the version
and issuing the request. RDFox addresses this by integrating these checks with
its transaction processing.</p>
<div class="section" id="id3">
<h4><span class="section-number">16.17.2.1. </span>Java API<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>To support version checking, the <code class="docutils literal notranslate"><span class="pre">DataStoreConnection</span></code> class in Java API
provides the <code class="docutils literal notranslate"><span class="pre">setNextOperationMustMatchDataStoreVersion()</span></code> and
<code class="docutils literal notranslate"><span class="pre">setNextOperationMustNotMatchDataStoreVersion()</span></code> methods. Both methods take
an integer argument, which configure the connection to expect or not expect a
specific version on the next operation. Please note that version validation is
not done in these methods themselves; rather, the version is validated on the
next operation executed that uses the connection. If the validation fails, the
request will throw a <code class="docutils literal notranslate"><span class="pre">DataStoreVersionDoesNotMatchException</span></code> or
<code class="docutils literal notranslate"><span class="pre">DataStoreVersionMatchesException</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataStoreConnection</span><span class="w"> </span><span class="n">dsConn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// Use the data store connection...</span>
<span class="p">...</span>
<span class="c1">// Save the data store version after the last transaction.</span>
<span class="kt">long</span><span class="w"> </span><span class="n">savedDataStoreVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsConn</span><span class="p">.</span><span class="na">getDataStoreVersionAfterLastOperation</span><span class="p">();</span>
<span class="c1">// Use the data store connection some more...</span>
<span class="p">...</span>
<span class="c1">// Configure the connection to expect savedDataStoreVersion in next transaction.</span>
<span class="c1">// The following call will not check the version!</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">setNextOperationMustMatchDataStoreVersion</span><span class="p">(</span><span class="n">savedDataStoreVersion</span><span class="p">);</span>
<span class="c1">// The following call fails if the version at the point of execution is</span>
<span class="c1">// different from savedDataStoreVersion.</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">importData</span><span class="p">(...);</span>
<span class="c1">// The following switches data store validation off.</span>
<span class="n">dsConn</span><span class="p">.</span><span class="na">setNextOperationMustMatchDataStoreVersion</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Once an expected version has been set on the connection, the value remains
active until <code class="docutils literal notranslate"><span class="pre">setNextOperationMustMatchDataStoreVersion()</span></code> is called with
argument <code class="docutils literal notranslate"><span class="pre">0</span></code>. Moreover, if the connection is configured to expect a
particular version and a data store update is successful, the data store
version will be incremented and the resulting value will be set as the next
expected data store version. In this way, users can process subsequent updates
on the connection without having to update an expected version.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">setNextOperationMustNotMatchDataStoreVersion()</span></code> method is analogous, but
it configures the connection to not accept a specific version. This can be
used, for example, to avoid reevaluating a complex query unless the data store
<em>has</em> changed. Successful updates will not change this parameter of the
connection.</p>
</div>
<div class="section" id="id4">
<h4><span class="section-number">16.17.2.2. </span>RESTful API<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>In the RESTful API, conditional requests are supported using standard HTTP
<code class="docutils literal notranslate"><span class="pre">If-Match</span></code> and <code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> headers. Specifically, if a request contains
an <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> header with a particular ETag, the request will succeed only if
the version of the data store matches the ETag when the request is executed.
This is illustrated by the following example, where the request (presumably)
fails because of a version mismatch.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/datastores/myStore/content</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">If-Match</span><span class="o">:</span> <span class="l">&quot;01234567890123456789-2&quot;</span>

[The facts/rules to be added in a format supported by RDFox]
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">412</span> <span class="ne">Precondition Failed</span>
<span class="na">ETag</span><span class="o">:</span> <span class="l">&quot;01234567890123456789-5&quot;</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">XX</span>

DataStoreVersionDoesNotMatchException: Data store version is 5, which is different from the expected version 2.
</pre></div>
</div>
<p>Note that the response in the above example contains the current ETag of the
data store. Thus, an application can try to use this ETag in any subsequent
request, which will succeed only if the data store has not been modified in the
meanwhile.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> header is analogous, but it ensures that the request
succeeds only if the version is different from the given one. This is
illustrated by the following request.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/datastores/myStore/sparql?query=SELECT+%3FX+%3FY+%3FZ+WHERE+{+%3FX+%3FY+%3FZ+}</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
<span class="na">If-None-Match</span><span class="o">:</span> <span class="l">&quot;01234567890123456789-5&quot;</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">304</span> <span class="ne">Not Modified</span>
<span class="na">ETag</span><span class="o">:</span> <span class="l">&quot;01234567890123456789-5&quot;</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">XX</span>

DataStoreVersionMatchesException: Data store version is equal to 5.
</pre></div>
</div>
<p>Conditional requests in RDFox differ from HTTP in the following minor ways.</p>
<ul class="simple">
<li><p>ETags are opaque values in HTTP that must match exactly. RDFox, however,
allows for partial matches. In particular, the value of <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> and
<code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> headers can have the form <code class="docutils literal notranslate"><span class="pre">&quot;uniqueID-version&quot;</span></code> where
<code class="docutils literal notranslate"><span class="pre">uniqueID</span></code> and <code class="docutils literal notranslate"><span class="pre">version</span></code> can either be specific values or the wildcard
character <code class="docutils literal notranslate"><span class="pre">*</span></code>. Thus, <code class="docutils literal notranslate"><span class="pre">&quot;01234567890123456789-*&quot;</span></code> matches any data store
whose unique ID is <code class="docutils literal notranslate"><span class="pre">01234567890123456789</span></code>, regardless of the current data
store version. Analogously, <code class="docutils literal notranslate"><span class="pre">&quot;*-5&quot;</span></code> matches any data store whose version is
<code class="docutils literal notranslate"><span class="pre">5</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;*-*&quot;</span></code> matches any data store.</p></li>
<li><p>HTTP allows one to specify more than one ETag in the <code class="docutils literal notranslate"><span class="pre">If-Match</span></code> or
<code class="docutils literal notranslate"><span class="pre">If-None-Match</span></code> headers. However, RDFox will reject such requests: the
allowed values for these headers are <code class="docutils literal notranslate"><span class="pre">*</span></code> (which means ‘match any’ in HTTP)
or a single ETag (possibly containing wildcard characters as explained above).</p></li>
</ul>
<p>Conditional requests may not be used in combination with explicitly opened
read/write transactions for the same reason that ETags are not included in
responses under such circumstances (see <a class="reference internal" href="#rest-detecting-updates"><span class="std std-numref">Section 16.17.1.2</span></a>).</p>
</div>
</div>
</div>
<div class="section" id="managing-roles">
<span id="apis-managing-roles"></span><h2><span class="section-number">16.18. </span>Managing Roles<a class="headerlink" href="#managing-roles" title="Permalink to this headline">¶</a></h2>
<p>This section describes the API calls responsible for managing the roles defined
within an RDFox server. For an introduction to RDFox’s access control model see
<a class="reference internal" href="access-control.html#access-control"><span class="std std-numref">Section 12</span></a>.</p>
<div class="section" id="listing-roles">
<h3><span class="section-number">16.18.1. </span>Listing Roles<a class="headerlink" href="#listing-roles" title="Permalink to this headline">¶</a></h3>
<p>The following request retrieves the list of roles defined within the server.
The response is written as an output of a SPARQL query that binds variable
<code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the names of the available roles.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/roles</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name
admin
group
user1
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">roleNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">listRoles</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-role">
<h3><span class="section-number">16.18.2. </span>Creating a Role<a class="headerlink" href="#creating-a-role" title="Permalink to this headline">¶</a></h3>
<p>The following request creates a new role. The role name is specified as part of
the request URL and the password or Argon2i password hash as a <code class="docutils literal notranslate"><span class="pre">text/plain</span></code>
body. The <code class="docutils literal notranslate"><span class="pre">password-specification-type</span></code> query parameter can be used to
specify whether the role should be created using a password (if the parameter
is not specified or set to <code class="docutils literal notranslate"><span class="pre">password</span></code>), an Argon2i password hash (if the
parameter is set to <code class="docutils literal notranslate"><span class="pre">password-hash</span></code>), or should have no password at all (if
the parameters is set to <code class="docutils literal notranslate"><span class="pre">none</span></code>).The location of the new role is returned in
the <code class="docutils literal notranslate"><span class="pre">Location</span></code> header.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/roles/user2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">14</span>

user2&#39;s secret
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/roles/user2</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">sConn</span><span class="p">.</span><span class="na">createRole</span><span class="p">(</span><span class="s">&quot;user2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user2&#39;s secret&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-role">
<h3><span class="section-number">16.18.3. </span>Deleting a Role<a class="headerlink" href="#deleting-a-role" title="Permalink to this headline">¶</a></h3>
<p>The following request deletes a role.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/roles/user2</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">sConn</span><span class="p">.</span><span class="na">deleteRole</span><span class="p">(</span><span class="s">&quot;user2&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-role-information">
<span id="apis-list-role-information"></span><h3><span class="section-number">16.18.4. </span>Listing Role Information<a class="headerlink" href="#listing-role-information" title="Permalink to this headline">¶</a></h3>
<p>The following request lists information about an existing role. The response is
written as an output of a SPARQL query that returns one answer per property of
the role. For each answer, the variable <code class="docutils literal notranslate"><span class="pre">?Name</span></code> contains a name of the
parameter and the variable <code class="docutils literal notranslate"><span class="pre">?Value</span></code> holds its value.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/roles/admin</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Property,Value
name,admin
password-hash,&quot;$argon2i$v=19$m=208651,t=3,p=16$xNWat7TDiKEGGU2W66u/Pw$h9ObPGi855ypuDBI7Nr2zeWAa6f2VBmIrFRs32gEXHY&quot;
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="w"> </span><span class="n">passwordHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">getRolePasswordHash</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-privileges">
<h3><span class="section-number">16.18.5. </span>Listing Privileges<a class="headerlink" href="#listing-privileges" title="Permalink to this headline">¶</a></h3>
<p>The following request lists the privileges of an existing role. The response is
written as an output of a SPARQL query that returns one answer per resource
specifier over which the role has any privileges. For each answer, the variable
<code class="docutils literal notranslate"><span class="pre">?AllowedAccessTypes</span></code> contains a comma-separated list of access types the
role is allowed to perform over the resources specified by the resource
specifier in the <code class="docutils literal notranslate"><span class="pre">?ResourceSpecifier</span></code> variable.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/roles/user1/privileges</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

ResourceSpecifier,AllowedAccessTypes
&gt;datastores,&quot;read,write&quot;
|roles,read
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Byte</span><span class="o">&gt;</span><span class="w"> </span><span class="n">privileges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">listPrivileges</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="granting-privileges-to-a-role">
<h3><span class="section-number">16.18.6. </span>Granting Privileges to a Role<a class="headerlink" href="#granting-privileges-to-a-role" title="Permalink to this headline">¶</a></h3>
<p>The following request grants the <code class="docutils literal notranslate"><span class="pre">read</span></code> and <code class="docutils literal notranslate"><span class="pre">write</span></code> privileges over the
data store list to an existing role.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/roles/user1/privileges?operation=grant&amp;resource-specifier=%7Cdatastores&amp;access-types=read,write</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">grantPrivileges</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;|datastores&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="n">ServerConnection</span><span class="p">.</span><span class="na">ACCESS_TYPE_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ServerConnection</span><span class="p">.</span><span class="na">ACCESS_TYPE_WRITE</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="revoking-privileges-from-a-role">
<h3><span class="section-number">16.18.7. </span>Revoking Privileges from a Role<a class="headerlink" href="#revoking-privileges-from-a-role" title="Permalink to this headline">¶</a></h3>
<p>The following request revokes the <code class="docutils literal notranslate"><span class="pre">write</span></code> privilege over the data store list
from an existing role.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/roles/user1/privileges?operation=revoke&amp;resource-specifier=%7Cdatastores&amp;access-types=write</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">revokePrivileges</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;|datastores&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="p">)(</span><span class="n">ServerConnection</span><span class="p">.</span><span class="na">ACCESS_TYPE_WRITE</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-memberships">
<h3><span class="section-number">16.18.8. </span>Listing Memberships<a class="headerlink" href="#listing-memberships" title="Permalink to this headline">¶</a></h3>
<p>The following request lists the roles of which the specified role is a member.
The response is written as an output of a SPARQL query that binds variable
<code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the names of the role’s super roles.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/roles/user1/memberships</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name
group
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">memberships</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">listRoleMemberships</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="granting-memberships">
<h3><span class="section-number">16.18.9. </span>Granting Memberships<a class="headerlink" href="#granting-memberships" title="Permalink to this headline">¶</a></h3>
<p>The following request grants membership of the role <code class="docutils literal notranslate"><span class="pre">group</span></code> to an existing
role.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/roles/user1/memberships?operation=grant&amp;super-role-name=group</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">grantRole</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;group&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="revoking-memberships">
<h3><span class="section-number">16.18.10. </span>Revoking Memberships<a class="headerlink" href="#revoking-memberships" title="Permalink to this headline">¶</a></h3>
<p>The following request revokes membership of the role <code class="docutils literal notranslate"><span class="pre">group</span></code> from an existing
role.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/roles/user1/memberships?operation=revoke&amp;super-role-name=group</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Changed
true
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">revokeRole</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;group&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-members">
<h3><span class="section-number">16.18.11. </span>Listing Members<a class="headerlink" href="#listing-members" title="Permalink to this headline">¶</a></h3>
<p>The following request lists the roles which are members of the specified role.
The response is written as an output of a SPARQL query that binds variable
<code class="docutils literal notranslate"><span class="pre">?Name</span></code> to the names of the role’s members.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/roles/group/members</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/csv; charset=UTF-8</span>

Name
user1
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">members</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sConn</span><span class="p">.</span><span class="na">listRoleMembers</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-passwords">
<h3><span class="section-number">16.18.12. </span>Changing Passwords<a class="headerlink" href="#changing-passwords" title="Permalink to this headline">¶</a></h3>
<p>The following request sets the password for the authenticated role. The request
body must contain the old and the new passwords separated by a single <code class="docutils literal notranslate"><span class="pre">\n</span></code>
(CR) character.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/password</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic dXNlcjE6dXNlcjE=</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">20</span>

user1&#39;s old password
user1&#39;s new password
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p><strong>Java API</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">sConn</span><span class="p">.</span><span class="na">changeRolePassword</span><span class="p">(</span><span class="s">&quot;user1&#39;s old password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user1&#39;s new password&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-endpoint-health">
<span id="rest-endpoint-health"></span><h2><span class="section-number">16.19. </span>Checking Endpoint Health<a class="headerlink" href="#checking-endpoint-health" title="Permalink to this headline">¶</a></h2>
<p>The following request may be used to test that the endpoint is healthy (able to
respond to requests). Note that no authorization is required, irrespective of
the server’s access control policy.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/health</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
<p>There is no equivalent of this API in Java.</p>
</div>
<div class="section" id="remote-shell-execution">
<h2><span class="section-number">16.20. </span>Remote Shell Execution<a class="headerlink" href="#remote-shell-execution" title="Permalink to this headline">¶</a></h2>
<p>The RESTful API includes support for using the <a class="reference internal" href="rdfox-shell.html#rdfox-shell"><span class="std std-ref">RDFox Shell</span></a>
remotely. The rest of this section describes the basic API, whereas
<a class="reference internal" href="rdfox-executable.html#remote-shell-client"><span class="std std-numref">Section 18.7</span></a> describes how to use the RDFox executable as a
client for these APIs.</p>
<div class="section" id="basic-remote-command-execution">
<h3><span class="section-number">16.20.1. </span>Basic Remote Command Execution<a class="headerlink" href="#basic-remote-command-execution" title="Permalink to this headline">¶</a></h3>
<p>To execute a shell script, one may <code class="docutils literal notranslate"><span class="pre">POST</span></code> it to the <code class="docutils literal notranslate"><span class="pre">/commands</span></code> path and
read the output of the commands returned in the response body. For example, the
following request sets the active data store and runs the <a class="reference internal" href="rdfox-shell.html#compact-command"><span class="std std-ref">compact</span></a> command on it.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/commands</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">22</span>

active myStore
compact
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

Data store connection &#39;myStore&#39; is active.
The current data store was compacted in 0.002000 s.
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Shell commands that require RDFox to access files, such as those that import
or export content, redirect shell output or invoke shell scripts, could be
used in conjunction with the remote shell API, or other APIs, to probe for
the existence of files in the server’s file system. To guard against
disclosing file and directory names that are unrelated to RDFox’s operation
in this way, RDFox’s core API implementations will only open files whose
paths are within the directory specified by the <code class="docutils literal notranslate"><span class="pre">sandbox-directory</span></code> server
parameter. Administrators should set this parameter to the deepest (that is,
furthest from the root) node that contains all of the paths that users of
the remote shell or other APIs should be able to access. See
<a class="reference internal" href="servers.html#server-parameters"><span class="std std-numref">Section 4.3</span></a> for more details.</p>
</div>
<div class="section" id="limitations">
<span id="rest-remote-shell-limitations"></span><h4><span class="section-number">16.20.1.1. </span>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h4>
<p>The remote shell API does not support commands that prompt for interaction.
Such commands fall into one of two categories. The first category is commands
that require confirmation such as <code class="docutils literal notranslate"><span class="pre">dstore</span> <span class="pre">delete</span> <span class="pre">myStore</span></code>. These commands can
be used remotely so long as the keyword <code class="docutils literal notranslate"><span class="pre">force</span></code> is appended to prevent them
from prompting. The second category is commands that prompt for a password.
Commands in this category cannot be used via the remote shell.</p>
<p>Commands for managing the endpoint (<code class="docutils literal notranslate"><span class="pre">endpoint</span></code> and <code class="docutils literal notranslate"><span class="pre">daemon</span></code>) cannot be used
via the remote shell.</p>
</div>
</div>
<div class="section" id="explicit-shell-management">
<span id="rest-explicit-shell-management"></span><h3><span class="section-number">16.20.2. </span>Explicit Shell Management<a class="headerlink" href="#explicit-shell-management" title="Permalink to this headline">¶</a></h3>
<p>By default, RDFox will create an instance of the remote shell for each RESTful
API request sent to the <code class="docutils literal notranslate"><span class="pre">/commands</span></code> path. This means that the state
maintained by a shell instance, such as variables, connections and prefix
definitions, is discarded at the end of each request. To overcome this and
allow the shell instance state to be preserved from one call to the next, one
can explicitly manage remote shell instances and associate them with command
execution requests. The following sequence of requests demonstrates this.
First, a new shell is created by submitting an empty <code class="docutils literal notranslate"><span class="pre">POST</span></code> request to the
<code class="docutils literal notranslate"><span class="pre">/shells</span></code> path:</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/shells</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">RDFox-Authentication-Token</span><span class="o">:</span> <span class="l">98765432109876543210</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">/shells/01234567890123456789</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</pre></div>
</div>
<p>On success, the URL of the newly created remote shell instance and an
authentication token specific for the shell instance are returned via the
<code class="docutils literal notranslate"><span class="pre">Location</span></code> and <code class="docutils literal notranslate"><span class="pre">RDFox-Authentication-Token</span></code> response headers respectively.
As with <a class="reference internal" href="#rest-explicit-connection-management"><span class="std std-ref">explicit connection management</span></a>, the newly created remote shell instance
is associated with the role that created it: either the role specified in
<code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header if basic authentication is used, or the guest
role if the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header is missing.</p>
<p>Once created, a remote shell instance may be used in calls to the <code class="docutils literal notranslate"><span class="pre">/commands</span></code>
API by specifying the final segment of its URL as the <code class="docutils literal notranslate"><span class="pre">shell</span></code> request
parameter.</p>
<p>Requests to use the remote shell instance must be authorized in one of two
ways. The first option is to use the standard <code class="docutils literal notranslate"><span class="pre">Basic</span></code> authentication scheme
with the name and password of the role that created the shell instance
(instances created by the guest role can be used without authentication).
Alternatively, the authentication token returned in the
<code class="docutils literal notranslate"><span class="pre">RDFox-Authentication-Token</span></code> response header can be used as in the following
example:</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/commands?shell=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">34</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">RDFox 98765432109876543210</span>

set myVariableName myVariableValue
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

myVariableName = &quot;myVariableValue&quot;
</pre></div>
</div>
<p>By submitting subsequent requests with the same remote shell instance, we see
that shell state set in one request is still available in subsequent requests:</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/commands?shell=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">22</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">RDFox 98765432109876543210</span>

echo $(myVariableName)
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">RDFox Endpoint</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

myVariableValue
</pre></div>
</div>
</div>
<div class="section" id="interrupting-remote-shell-execution">
<h3><span class="section-number">16.20.3. </span>Interrupting Remote Shell Execution<a class="headerlink" href="#interrupting-remote-shell-execution" title="Permalink to this headline">¶</a></h3>
<p>Commands submitted to an explicitly created remote shell instance can be
interrupted by submitting a <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request to the full URL of the instance
with the <code class="docutils literal notranslate"><span class="pre">operation</span></code> request parameter set to <code class="docutils literal notranslate"><span class="pre">interrupt</span></code>.</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">PATCH</span> <span class="nn">/shells/01234567890123456789?operation=interrupt</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:12110</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">RDFox 98765432109876543210</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
</div>
<div class="section" id="inspecting-the-status-of-the-remote-shell-instance">
<h3><span class="section-number">16.20.4. </span>Inspecting the Status of the Remote Shell Instance<a class="headerlink" href="#inspecting-the-status-of-the-remote-shell-instance" title="Permalink to this headline">¶</a></h3>
<p>Requests to the <code class="docutils literal notranslate"><span class="pre">/commands</span></code> API that are correctly formatted and carry valid
credentials will always receive a <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> response code, irrespective of
errors arising from command execution. Clients can, however, receive additional
information about the status of the shell at the end of each request through
HTTP trailers. To opt-in to receive trailers, clients must add the <code class="docutils literal notranslate"><span class="pre">TE:</span>
<span class="pre">trailers</span></code> request header. RDFox will then transmit trailers including the
<code class="docutils literal notranslate"><span class="pre">RDFox-Shell-Status</span></code> trailer:</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/commands?shell=01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">4</span>
<span class="na">TE</span><span class="o">:</span> <span class="l">trailers</span>

quit
</pre></div>
</div>
<p><strong>Response (with raw response body)</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Trailer</span><span class="o">:</span> <span class="l">RDFox-Final-Status-Code, RDFox-Error, RDFox-Shell-Status</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain; charset=UTF-8</span>
<span class="na">Transfer-Encoding</span><span class="o">:</span> <span class="l">chunked</span>

0
RDFox-Shell-Status: quit
RDFox-Final-Status-Code: 200
RDFox-Error: &quot;&quot;
</pre></div>
</div>
<p>The possible values for the <code class="docutils literal notranslate"><span class="pre">RDFox-Shell-Status</span></code> trailer are as follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">running</span></code></dt><dd><p>The remote shell instance is running and available for further requests.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">quit</span></code></dt><dd><p>The remote shell instance has exited and is not available for any further
requests. This status is returned when the shell has exited due to the
commands in the request (as in the example above) and when an
implicitly-created shell has successfully executed all of the commands in the
request it was created for.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aborted-duplicate</span></code></dt><dd><p>Execution of the commands in the request was aborted due to an attempt to
create a resource with a name that is already in use. The remote shell
instance has exited and is not available for any further requests. This
status will only be returned when the <code class="docutils literal notranslate"><span class="pre">on-error</span></code> variable of the shell is
set to <code class="docutils literal notranslate"><span class="pre">stop</span></code>. See <a class="reference internal" href="rdfox-shell.html#shell-error-handling"><span class="std std-numref">Section 15.5</span></a> for more details of how
errors are handled by the shell.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aborted-non-duplicate</span></code></dt><dd><p>Execution of the commands in the request was aborted due to an error other
than an attempt to create a resource with a name that is already in use. The
remote shell instance has exited and is not available for any further
requests. This status will only be returned when the <code class="docutils literal notranslate"><span class="pre">on-error</span></code> variable of
the shell is set to <code class="docutils literal notranslate"><span class="pre">stop</span></code> or <code class="docutils literal notranslate"><span class="pre">continue-if-exists</span></code>. See
<a class="reference internal" href="rdfox-shell.html#shell-error-handling"><span class="std std-numref">Section 15.5</span></a> for more details of how errors are handled by
the shell.</p>
</dd>
</dl>
</div>
<div class="section" id="deletion-of-remote-shell-instances">
<h3><span class="section-number">16.20.5. </span>Deletion of Remote Shell Instances<a class="headerlink" href="#deletion-of-remote-shell-instances" title="Permalink to this headline">¶</a></h3>
<p>Remote shell instances created using the <code class="docutils literal notranslate"><span class="pre">/shells</span></code> path will be automatically
garbage collected by the endpoint once they have been unused for the endpoint’s
<code class="docutils literal notranslate"><span class="pre">object-keep-alive-time</span></code> (see <a class="reference internal" href="rdfox-endpoint.html#endpoint-parameters"><span class="std std-numref">Section 19.2</span></a>). Alternatively,
they may be deleted explicitly as demonstrated by the following request:</p>
<p><strong>Request</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/shells/01234567890123456789</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:12110</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rdfox-shell.html" class="btn btn-neutral float-left" title="15. RDFox Shell" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="javadoc.html" class="btn btn-neutral float-right" title="17. Javadoc" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Oxford Semantic Technologies Ltd.</p>
  </div>

  
     

    <!-- consent banner, edit cookies button and HS cookies -->
    <!-- Start of HubSpot Embed Code -->
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/6485449.js"></script>
    <!-- End of HubSpot Embed Code -->

    <!-- Cookies settings button -->
    <!-- Start of HubSpot code snippet -->
    <button type="button" id="hs_show_banner_button"
    style="background-color: #fff; border: 1px solid #2980b9;
        border-radius: 3px; padding: 5px 8px; text-decoration: none; color: #2980b9;
        font-family: inherit; font-size: 80%; font-weight: normal; line-height: inherit;
        text-align: left; text-shadow: none;"
    onClick="(function(){
            var _hsp = window._hsp = window._hsp || [];
            _hsp.push(['showBanner']);
        })()"
    >
    Cookie Settings
    </button>
    <style>
        @media all and (min-width:1160px){
            .hs-cookie-notification-position-bottom {width: 80%!important;}
        }
    </style>
    <!-- End of HubSpot code snippet -->
    <!-- consent banner, edit cookies button and HS cookies -->

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>